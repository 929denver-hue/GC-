<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬ä¸ƒå±† çµ¦ç¤¾å·¥æ„›çš„é¼“å‹µ - åƒç´ å®ˆè­·è€…</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --gc-orange: #FF8C00;
            --gc-yellow: #FFD700;
            --pixel-bg: #2C2C2C;
            --text-color: #333;
            --white: #fff;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Press Start 2P', cursive; /* æ ¸å¿ƒåƒç´ å­—é«” */
            background-color: var(--pixel-bg);
            color: var(--white);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- é ‚éƒ¨ Boss è¡€æ¢å€åŸŸ --- */
        .boss-bar-container {
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        
        .boss-label {
            font-size: 12px;
            margin-bottom: 5px;
            color: #FF6B6B;
            text-align: center;
        }

        .health-bar-frame {
            border: 4px solid var(--white);
            height: 30px;
            background: #000;
            position: relative;
        }

        .health-bar-fill {
            height: 100%;
            background: #FF4444; /* Boss è¡€æ¢é¡è‰² */
            width: 40%; /* æ¨¡æ“¬ç›®å‰é€²åº¦ï¼Œå‰©é¤˜è¡€é‡ */
            transition: width 0.5s;
        }

        /* --- é“å…·æ¬„ (Inventory) --- */
        .inventory {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 600px;
            margin-bottom: 10px;
            font-size: 12px;
            color: var(--gc-yellow);
        }

        /* --- ä¸»éŠæˆ²æ©Ÿä»‹é¢ (Game Console) --- */
        .game-console {
            background-color: var(--gc-orange);
            padding: 20px;
            border: 4px solid #000;
            box-shadow: 8px 8px 0px #000; /* åƒç´ é™°å½±æ•ˆæœ */
            width: 100%;
            max-width: 500px;
            border-radius: 4px;
            position: relative;
        }

        /* è¢å¹•å€åŸŸ */
        .screen {
            background-color: #E0F8CF; /* é¡ä¼¼ GameBoy çš„ç¶ åº•è‰²ï¼Œæˆ–æ”¹ç”¨ç´”ç™½ */
            background-color: #fff;
            border: 4px solid #333;
            height: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            color: var(--text-color);
            position: relative;
            overflow: hidden;
        }

        /* è£é£¾ç”¨çš„åƒç´ é» */
        .decor-pixel {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            background: #ccc;
            box-shadow: -4px 4px 0 #999;
        }

        /* --- å…§å®¹å‹•æ…‹åˆ‡æ›å€ --- */
        
        /* 1. å¾…æ©Ÿç•«é¢ */
        .state-idle {
            text-align: center;
            display: flex; /* JSæ§åˆ¶åˆ‡æ› */
            flex-direction: column;
            align-items: center;
        }

        .pixel-hero-icon {
            font-size: 50px;
            margin-bottom: 20px;
        }

        /* 2. è½‰å‹•ç•«é¢ (Spinning) */
        .state-spinning {
            display: none;
            font-size: 20px;
            animation: blink 0.5s infinite;
        }

        /* 3. çµæœ/ä»»å‹™ç•«é¢ (Quest) */
        .state-quest {
            display: none; 
            width: 100%;
            text-align: left;
        }

        /* çœŸå¯¦ç…§ç‰‡å®¹å™¨ (æ ¸å¿ƒæ„Ÿå‹•é») */
        .real-photo-frame {
            width: 100%;
            height: 180px;
            background-color: #333;
            margin-bottom: 10px;
            border: 4px solid #000;
            overflow: hidden;
            position: relative;
        }

        .real-photo {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* é è¨­å¸¶ä¸€é»é»åƒç´ æ¿¾é¡ï¼Œä»»å‹™è§£é–æ™‚ç§»é™¤ */
            /* filter: grayscale(100%); */ 
        }

        .quest-info {
            font-family: 'Helvetica', sans-serif; /* å…§æ–‡æ”¹ç”¨é»‘é«”æ˜“è®€ */
            font-size: 14px;
            line-height: 1.4;
        }
        
        .quest-tag {
            background: var(--gc-orange);
            color: #fff;
            padding: 2px 6px;
            font-size: 10px;
            display: inline-block;
            margin-bottom: 5px;
            font-family: 'Press Start 2P';
        }

        .quest-story {
            margin-bottom: 10px;
            border-left: 3px solid var(--gc-orange);
            padding-left: 8px;
            color: #555;
            font-style: italic;
        }

        /* --- æ“ä½œå€ --- */
        .controls {
            margin-top: 20px;
            text-align: center;
        }

        .btn-main {
            background-color: #FF4444;
            color: #fff;
            border: 4px solid #8B0000;
            padding: 15px 20px;
            font-family: 'Press Start 2P', cursive;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 4px 0 #8B0000;
            transition: transform 0.1s;
            width: 100%;
        }

        .btn-main:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #8B0000;
        }

        .btn-disabled {
            background-color: #ccc;
            border-color: #999;
            box-shadow: 0 4px 0 #999;
            cursor: not-allowed;
        }

        /* ç•™è¨€è¼¸å…¥æ¡† */
        .message-input-area {
            display: none; /* ä»»å‹™é–‹å§‹å¾Œæ‰é¡¯ç¤º */
            width: 100%;
            margin-top: 10px;
        }

        textarea {
            width: 100%;
            height: 60px;
            border: 2px solid #000;
            padding: 8px;
            font-family: sans-serif;
            font-size: 14px;
            resize: none;
        }

        /* --- å½ˆçª— (Loot Drop) --- */
        .loot-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--white);
            border: 4px solid var(--gc-yellow);
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.7);
            padding: 20px;
            text-align: center;
            z-index: 999;
            display: none;
            width: 80%;
            max-width: 300px;
            color: #000;
        }

        .loot-icon {
            font-size: 40px;
            margin: 10px 0;
            animation: bounce 1s infinite;
        }
        
        .item-card {
            border: 2px dashed #ccc;
            padding: 10px;
            margin: 10px 0;
            background: #f9f9f9;
        }

        /* --- å‹•ç•« --- */
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* RWD */
        @media (max-width: 400px) {
            .btn-main { font-size: 10px; }
            .boss-label { font-size: 10px; }
        }

    </style>
</head>
<body>

    <div class="boss-bar-container">
        <div class="boss-label">BOSSï¼šå†·æ¼ é­”ç‹ (HP å‰©é¤˜ 40%)</div>
        <div class="health-bar-frame">
            <div class="health-bar-fill" id="boss-hp"></div>
        </div>
    </div>

    <div class="inventory">
        <span>PLAYER: æ‚¨</span>
        <span>ğŸ« æŠ½çåˆ¸: <span id="ticket-count" style="color:#fff;">0</span> å¼µ</span>
    </div>

    <div class="game-console">
        <div class="screen">
            <div class="decor-pixel"></div>

            <div id="screen-idle" class="state-idle">
                <div class="pixel-hero-icon">ğŸ›¡ï¸</div>
                <div style="line-height: 1.6; margin-bottom: 20px;">
                    PIXEL GUARDIANS<br>
                    <span style="font-size: 10px; color: #666;">INSERT LOVE TO START</span>
                </div>
                <div style="font-size: 10px;">
                    ä»Šå¤©ï¼Œå‘½é‹æœƒå¸¶ä½ é‡è¦‹<br>å“ªä¸€ä½å®ˆè­·è€…ï¼Ÿ
                </div>
            </div>

            <div id="screen-spinning" class="state-spinning">
                SEARCHING...<br>
                <div id="spin-text" style="margin-top:20px; font-size: 30px;">ğŸ”</div>
            </div>

            <div id="screen-quest" class="state-quest">
                <div class="real-photo-frame">
                    <img src="https://images.unsplash.com/photo-1531206715517-5c0ba140b2b8?auto=format&fit=crop&w=600&q=80" alt="ç¤¾å·¥ç…§ç‰‡" class="real-photo" id="quest-img">
                </div>
                
                <div class="quest-info">
                    <div class="quest-tag" id="quest-tag">#æ·±å¤œçš„ç‡ˆå¡”</div>
                    <div style="font-weight:bold; margin-bottom:5px;" id="quest-name">å±æ±ä¼¯å¤§å°¼ä¹‹å®¶</div>
                    <div class="quest-story" id="quest-story">
                        ã€Œå­©å­åŠå¤œå“­é†’æ™‚ï¼Œç¬¬ä¸€å€‹æŠ±ä½ä»–å€‘çš„ï¼Œé€šå¸¸ä¸æ˜¯çˆ¸åª½ï¼Œè€Œæ˜¯å€¼ç­çš„æˆ‘å€‘ã€‚ã€
                    </div>
                    <div style="font-size: 10px; color: #888;">
                        ç‹€æ…‹: HP ä½è½ (äººåŠ›çŸ­ç¼º)<br>
                        æŠ€èƒ½: ç„¡é™è€å¿ƒ Lv.99
                    </div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button id="btn-spin" class="btn-main">è½‰å‹•ç·£åˆ† (PUSH)</button>
            
            <div id="message-area" class="message-input-area">
                <textarea id="msg-input" placeholder="è«‹è¼¸å…¥çµ¦ç¤¾å·¥çš„é¼“å‹µ... (ä¾‹å¦‚ï¼šè¾›è‹¦äº†ï¼Œè¬è¬ä½ å€‘çš„æº«æŸ”)"></textarea>
                <button id="btn-submit" class="btn-main" style="margin-top: 10px; background-color: var(--gc-orange); border-color: #B86500;">ç™¼é€è£œè¡€é­”æ³•</button>
            </div>
        </div>
    </div>

    <div id="loot-popup" class="loot-popup">
        <h3 style="color: var(--gc-orange); font-size: 14px;">ä»»å‹™å®Œæˆï¼</h3>
        <div style="font-size: 10px; margin-bottom: 10px;">ç¤¾å·¥ HP +1000</div>
        
        <div class="item-card">
            <div class="loot-icon">ğŸ«</div>
            <div style="font-size: 12px; font-weight: bold;">å‚³èªªæŠ½çåˆ¸ x1</div>
            <div style="font-size: 10px; color: #666; margin-top:5px;">å·²å­˜å…¥é“å…·æ¬„</div>
        </div>

        <div style="font-size: 10px; color: #888; margin-top: 10px;">
            æœ‰æ©Ÿæœƒç²å¾—ï¼š<br>
            [SSR] é¼ç‹éº»è¾£æ¹¯åº•<br>
            [SR] è‰¾ç‘ªçµ²æ·¨åŒ–æ¶²
        </div>

        <button id="btn-close-popup" class="btn-main" style="margin-top: 15px; font-size: 10px; padding: 10px;">ç¹¼çºŒç´¯ç© (é‚„æœ‰ 2 æ¬¡)</button>
    </div>

    <script>
        // æ¨¡æ“¬ 30 é–“å–®ä½çš„è³‡æ–™åº« (JSON)
        const unitsData = [
            {
                name: "å±æ±ä¼¯å¤§å°¼ä¹‹å®¶",
                tag: "#æ·±å¤œçš„ç‡ˆå¡”",
                story: "ã€Œå­©å­åŠå¤œå“­é†’æ™‚ï¼Œç¬¬ä¸€å€‹æŠ±ä½ä»–å€‘çš„ï¼Œé€šå¸¸ä¸æ˜¯çˆ¸åª½ï¼Œè€Œæ˜¯å€¼ç­çš„æˆ‘å€‘ã€‚ã€",
                img: "https://images.unsplash.com/photo-1488521787991-ed7bbaae773c?auto=format&fit=crop&w=600&q=80" // ç¤ºæ„åœ–
            },
            {
                name: "è¯å±±åŸºé‡‘æœƒ (èŠ±è“®ç«™)",
                tag: "#æ™‚é–“çš„é™ªä¼´è€…",
                story: "ã€Œæœ‰æ™‚å€™ï¼Œé˜¿å…¬é˜¿å¬¤ç­‰çš„ä¸æ˜¯é‚£å€‹ä¾¿ç•¶ï¼Œè€Œæ˜¯é€ä¾¿ç•¶çš„é‚£å€‹äººï¼Œèƒ½è·Ÿä»–èªªèªªè©±ã€‚ã€",
                img: "https://images.unsplash.com/photo-1516307365426-bea591f05011?auto=format&fit=crop&w=600&q=80"
            },
            {
                name: "èŠ’è‰å¿ƒæ…ˆå–„å”æœƒ",
                tag: "#å¹³è¦–çš„æº«æŸ”",
                story: "ã€Œè¹²ä¸‹ä¾†ï¼Œä¸æ˜¯å› ç‚ºè…¿ç— ã€‚è€Œæ˜¯åªæœ‰ç•¶è¦–ç·šå¹³è¡Œçš„æ™‚å€™ï¼Œå°è©±æ‰çœŸæ­£é–‹å§‹ã€‚ã€",
                img: "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?auto=format&fit=crop&w=600&q=80"
            }
        ];

        // è®Šæ•¸
        let ticketCount = 0;
        const btnSpin = document.getElementById('btn-spin');
        const screenIdle = document.getElementById('screen-idle');
        const screenSpinning = document.getElementById('screen-spinning');
        const screenQuest = document.getElementById('screen-quest');
        const spinText = document.getElementById('spin-text');
        const messageArea = document.getElementById('message-area');
        const btnSubmit = document.getElementById('btn-submit');
        const lootPopup = document.getElementById('loot-popup');
        const btnClosePopup = document.getElementById('btn-close-popup');
        const ticketDisplay = document.getElementById('ticket-count');
        const bossHp = document.getElementById('boss-hp');

        // 1. é»æ“Šã€Œè½‰å‹•ç·£åˆ†ã€
        btnSpin.addEventListener('click', () => {
            // åˆ‡æ›ç‹€æ…‹ -> è½‰å‹•ä¸­
            screenIdle.style.display = 'none';
            screenQuest.style.display = 'none';
            messageArea.style.display = 'none';
            screenSpinning.style.display = 'block';
            btnSpin.innerText = "æœå°‹å®ˆè­·è€…ä¸­...";
            btnSpin.classList.add('btn-disabled');
            
            // æ¨¡æ“¬è½‰å‹•å‹•ç•« (åœ–ç¤ºè·³å‹•)
            let spinInterval = setInterval(() => {
                const icons = ['ğŸ›¡ï¸', 'â¤ï¸', 'ğŸ', 'âš¡'];
                spinText.innerText = icons[Math.floor(Math.random() * icons.length)];
            }, 100);

            // 1.5ç§’å¾Œåœä¸‹ï¼Œé¡¯ç¤ºéš¨æ©Ÿå–®ä½
            setTimeout(() => {
                clearInterval(spinInterval);
                showRandomQuest();
            }, 1500);
        });

        // 2. é¡¯ç¤ºä»»å‹™ (çœŸå¯¦æ•…äº‹)
        function showRandomQuest() {
            // éš¨æ©Ÿé¸ä¸€å€‹å–®ä½
            const unit = unitsData[Math.floor(Math.random() * unitsData.length)];
            
            // å¡«å…¥è³‡æ–™
            document.getElementById('quest-name').innerText = unit.name;
            document.getElementById('quest-tag').innerText = unit.tag;
            document.getElementById('quest-story').innerText = unit.story;
            document.getElementById('quest-img').src = unit.img;

            // åˆ‡æ›ç•«é¢
            screenSpinning.style.display = 'none';
            screenQuest.style.display = 'block';
            
            // è§£é–ç•™è¨€å€
            btnSpin.style.display = 'none'; // éš±è—è½‰å‹•æŒ‰éˆ•
            messageArea.style.display = 'block'; // é¡¯ç¤ºç•™è¨€å€
        }

        // 3. é€å‡ºç•™è¨€
        btnSubmit.addEventListener('click', () => {
            const input = document.getElementById('msg-input');
            if(input.value.trim() === "") {
                alert("è«‹è¼¸å…¥ä¸€å¥é¼“å‹µçš„è©±ï¼Œç¤¾å·¥æ‰æ”¶å¾—åˆ°å–”ï¼");
                return;
            }

            // é€™è£¡å¯ä»¥åŠ å…¥ AJAX å‚³é€ç•™è¨€åˆ°å¾Œç«¯
            // console.log("ç•™è¨€é€å‡º:", input.value);

            // é¡¯ç¤ºæ‰å¯¶å½ˆçª—
            lootPopup.style.display = 'block';
            
            // æ›´æ–°é“å…·æ¬„
            ticketCount++;
            ticketDisplay.innerText = ticketCount;

            // æ›´æ–° Boss è¡€æ¢ (è¦–è¦ºæ•ˆæœ)
            // å‡è¨­æ¯æ¬¡æ‰£ä¸€é»è¡€
            const currentWidth = parseFloat(getComputedStyle(bossHp).width);
            const parentWidth = parseFloat(getComputedStyle(bossHp.parentElement).width);
            let newPercent = ((currentWidth - 20) / parentWidth) * 100;
            if(newPercent < 0) newPercent = 0;
            bossHp.style.width = newPercent + "%";
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            input.value = "";
        });

        // 4. é—œé–‰å½ˆçª—ï¼Œé‡ç½®éŠæˆ²
        btnClosePopup.addEventListener('click', () => {
            lootPopup.style.display = 'none';
            
            // å›åˆ°å¾…æ©Ÿç•«é¢ï¼Œæˆ–è€…ç›´æ¥é¡¯ç¤ºæŒ‰éˆ•è®“ä½¿ç”¨è€…å†è½‰
            screenQuest.style.display = 'none';
            messageArea.style.display = 'none';
            screenIdle.style.display = 'flex';
            
            btnSpin.style.display = 'block';
            btnSpin.classList.remove('btn-disabled');
            btnSpin.innerText = "å†è½‰ä¸€æ¬¡ (é‚„æœ‰ 2 æ¬¡)";
        });

    </script>
</body>
</html>
