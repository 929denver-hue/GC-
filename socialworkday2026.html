<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 çµ¦ç¤¾å·¥æ„›çš„é¼“å‹µ - æº«æš–è²©è³£æ©Ÿ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Press+Start+2P&family=Noto+Serif+TC:wght@600&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            /* æš–è‰²èª¿é…è‰²ï¼šå»å†·å†°å†°æ„Ÿ */
            --primary: #FF8F00;      /* æº«æš–æ©˜ */
            --secondary: #FFD54F;    /* é™½å…‰é»ƒ */
            --bg-color: #FFF8E1;     /* ç±³ç™½åº• */
            --machine-body: #FF7043; /* æ©Ÿå°ç´…æ©˜è‰² */
            --machine-glass: #E1F5FE;/* ç»ç’ƒè— */
            --text-main: #4E342E;    /* æ·±å’–å­— */
            --accent: #FF5252;       /* æ„›å¿ƒç´… */
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; font-family: 'Noto Sans TC', sans-serif; 
            color: var(--text-main); background-color: var(--bg-color); 
            overflow-x: hidden;
        }

        /* --- é ‚éƒ¨å°èˆª & é€²åº¦ --- */
        .header-bar {
            padding: 10px 15px; background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100;
        }
        .global-energy { flex: 1; margin-right: 15px; }
        .energy-label { font-size: 10px; color: #888; display: flex; justify-content: space-between; margin-bottom: 2px; }
        .energy-track { width: 100%; height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
        .energy-fill { height: 100%; width: 78%; background: linear-gradient(90deg, var(--secondary), var(--primary)); border-radius: 4px; }
        
        .btn-bag {
            background: var(--text-main); color: #fff; border: none; padding: 6px 12px;
            border-radius: 20px; font-size: 12px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 5px;
        }

        /* --- è·‘é¦¬ç‡ˆ (ç†±é¬§æ„Ÿï¼Œä½†ä¸åˆºçœ¼) --- */
        .warm-marquee {
            background: var(--secondary); color: var(--text-main); padding: 8px 0;
            overflow: hidden; white-space: nowrap; font-size: 12px; font-weight: bold;
            border-bottom: 2px solid #fff;
        }
        .marquee-content { display: inline-block; padding-left: 100%; animation: ticker 25s linear infinite; }
        @keyframes ticker { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        /* --- ä¸»èˆå°ï¼šæº«æš–è²©è³£æ©Ÿ --- */
        #main-stage {
            min-height: 85vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px; position: relative;
            background-image: radial-gradient(#FFF3E0 20%, transparent 20%), radial-gradient(#FFF3E0 20%, transparent 20%);
            background-size: 20px 20px; background-position: 0 0, 10px 10px; /* é»é»èƒŒæ™¯ */
        }

        /* æ©Ÿå°æœ¬é«” (CSS Drawing) */
        .vending-machine {
            width: 300px; height: 520px; background: var(--machine-body);
            border-radius: 40px 40px 10px 10px; position: relative;
            box-shadow: 0 15px 0 #D84315, 0 25px 20px rgba(0,0,0,0.2);
            border: 4px solid #fff; display: flex; flex-direction: column; align-items: center;
            transition: transform 0.2s;
        }
        .vending-machine::before { /* é ‚éƒ¨è£é£¾ */
            content: ''; position: absolute; top: -15px; width: 120px; height: 30px;
            background: #fff; border-radius: 15px; left: 50%; transform: translateX(-50%);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 2;
        }
        .machine-title {
            position: absolute; top: -10px; z-index: 3; font-size: 12px; font-weight: bold; color: var(--machine-body);
            background: var(--secondary); padding: 4px 10px; border-radius: 10px;
        }

        /* ç»ç’ƒå±•ç¤ºçª— */
        .glass-window {
            width: 260px; height: 280px; background: var(--machine-glass);
            border-radius: 20px 20px 5px 5px; margin-top: 30px;
            border: 4px solid rgba(255,255,255,0.5); position: relative; overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
        
        /* æ©Ÿå°å…§çš„è† å›Š (è£é£¾) */
        .capsule-deco {
            position: absolute; width: 40px; height: 40px; border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.1);
        }
        .c1 { background: #FFCDD2; bottom: 20px; left: 30px; transform: rotate(15deg); }
        .c2 { background: #C8E6C9; bottom: 50px; left: 80px; transform: rotate(-10deg); }
        .c3 { background: #BBDEFB; bottom: 30px; right: 40px; transform: rotate(45deg); }
        
        /* èªªè©±æ°£æ³¡ (å¼•å°èˆ‡æº«åº¦) */
        .speech-bubble {
            position: absolute; top: 60px; left: 50%; transform: translateX(-50%);
            background: #fff; padding: 10px 15px; border-radius: 20px;
            font-size: 13px; font-weight: bold; color: var(--text-main);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 80%; text-align: center;
            animation: floatBubble 3s infinite ease-in-out; z-index: 10;
        }
        .speech-bubble::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%);
            border-width: 8px 8px 0; border-style: solid; border-color: #fff transparent;
        }
        @keyframes floatBubble { 0%,100% {transform:translate(-50%,0);} 50% {transform:translate(-50%,-5px);} }

        /* æ“ä½œé¢æ¿ */
        .control-panel {
            width: 100%; padding: 0 20px; margin-top: 15px; display: flex; justify-content: space-between; align-items: center;
        }
        .coin-slot {
            width: 15px; height: 50px; background: #333; border-radius: 10px; border: 2px solid #aaa;
        }
        
        /* äº’å‹•å¤§æŒ‰éˆ• (æ„›å¿ƒå¹£) */
        .coin-btn {
            width: 80px; height: 80px; background: var(--secondary);
            border-radius: 50%; border: 4px solid #fff;
            display: flex; align-items: center; justify-content: center;
            font-size: 40px; color: var(--accent); cursor: pointer;
            box-shadow: 0 5px 0 #FFA000, 0 10px 10px rgba(0,0,0,0.2);
            transition: 0.1s; animation: pulse 2s infinite; position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
        }
        .coin-btn:active { transform: translateX(-50%) translateY(5px); box-shadow: 0 0 0 #FFA000; }
        @keyframes pulse { 0% {transform: translateX(-50%) scale(1);} 50% {transform: translateX(-50%) scale(1.05);} 100% {transform: translateX(-50%) scale(1);} }

        .take-out-door {
            width: 200px; height: 60px; background: #333; border-radius: 5px 5px 15px 15px;
            margin-top: auto; margin-bottom: 20px; border: 3px solid #555; position: relative; overflow: hidden;
        }

        /* --- è† å›Šæ‰“é–‹å¾Œçš„å¡ç‰‡ (Modal) --- */
        .capsule-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 200;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .story-card {
            background: #fff; width: 100%; max-width: 380px; border-radius: 15px; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh; display: flex; flex-direction: column;
        }
        @keyframes popUp { from { transform: scale(0.8) translateY(50px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }

        .sc-header { position: relative; height: 180px; flex-shrink: 0; }
        .sc-img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.9); }
        .sc-badge { 
            position: absolute; bottom: 10px; left: 15px; background: #fff; padding: 4px 12px; 
            border-radius: 20px; font-weight: bold; font-size: 12px; color: var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .sc-body { padding: 20px; overflow-y: auto; }
        .sc-desc { font-size: 14px; line-height: 1.6; color: #555; text-align: justify; margin-bottom: 20px; border-left: 3px solid var(--secondary); padding-left: 10px; }
        
        .section-title { font-size: 12px; font-weight: bold; color: var(--primary); margin-bottom: 8px; margin-top: 15px; display: block; }
        
        /* æ¨™ç±¤é¸æ“‡ (ä¸‰é¸ä¸€) */
        .tag-options { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
        .tag-opt { 
            border: 1px solid #ddd; padding: 6px 12px; border-radius: 20px; font-size: 12px; color: #666; cursor: pointer; transition: 0.2s; 
        }
        .tag-opt.active { background: var(--primary); color: #fff; border-color: var(--primary); }

        /* è´ŠåŠ©å•†é“å…· (æ©«å‘æ²å‹•) */
        .props-container { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .prop-item { 
            min-width: 90px; border: 1px solid #eee; border-radius: 8px; padding: 8px; text-align: center; cursor: pointer; background: #fafafa;
        }
        .prop-item.selected { border: 2px solid var(--primary); background: #FFF8E1; }
        .prop-icon { font-size: 20px; display: block; }
        .prop-name { font-size: 10px; font-weight: bold; display: block; margin-top: 2px; }
        .prop-brand { font-size: 9px; color: #999; }

        /* æ™ºæ…§è¼¸å…¥ */
        .smart-input-area { position: relative; }
        .smart-btn { position: absolute; right: 0; top: -25px; font-size: 10px; color: #fff; background: #999; padding: 2px 8px; border-radius: 10px; cursor: pointer; }
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-family: inherit; font-size: 13px; resize: none; background: #FAFAFA; }

        /* ç¢ºèªæŒ‰éˆ• */
        .btn-confirm {
            background: var(--primary); color: #fff; border: none; width: 100%; padding: 15px;
            font-size: 14px; font-weight: bold; cursor: pointer; margin-top: 10px;
            display: flex; justify-content: center; align-items: center; gap: 5px;
        }
        .btn-confirm:disabled { background: #ccc; }

        /* éš±å½¢æˆ°ç·šæ¨™ç¤º */
        .faction-mark { font-size: 10px; color: #ccc; text-align: center; margin-top: 10px; display: none; }

        /* --- å…¶ä»–å€å¡Š --- */
        .footer-area { text-align: center; padding: 40px 20px; font-size: 12px; color: #888; background: #fff; margin-top: 20px; }
        .search-area { background: #f0f0f0; padding: 30px 20px; text-align: center; border-radius: 20px 20px 0 0; margin-top: -20px; position: relative; z-index: 5; }
        .search-input { padding: 10px; border-radius: 20px; border: 1px solid #ccc; width: 70%; margin-right: 5px; }

        /* æ‹ç«‹å¾—é è¦½ Modal */
        #preview-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 300; align-items: center; justify-content: center; padding: 20px; }
        #capture-target { background: #fff; padding: 15px 15px 40px 15px; width: 300px; transform: rotate(-2deg); box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .polaroid-img { width: 100%; height: 220px; object-fit: cover; background: #eee; margin-bottom: 15px; filter: contrast(1.1); }
        .polaroid-text { font-family: 'Noto Serif TC'; font-size: 14px; color: #333; line-height: 1.5; }
        .polaroid-footer { margin-top: 10px; font-size: 10px; color: #999; display: flex; justify-content: space-between; }
        .stamp { position: absolute; bottom: 20px; right: 20px; border: 2px solid var(--primary); color: var(--primary); padding: 5px; font-size: 10px; font-weight: bold; transform: rotate(-10deg); border-radius: 5px; }

    </style>
</head>
<body>

    <div class="header-bar">
        <div class="global-energy">
            <div class="energy-label"><span>â¤ï¸ GLOBAL LOVE ENERGY</span><span>LV.78</span></div>
            <div class="energy-track"><div class="energy-fill"></div></div>
        </div>
        <button class="btn-bag" onclick="alert('èƒŒåŒ…åŠŸèƒ½ï¼šæŸ¥çœ‹å·²æ”¶é›†çš„æ„Ÿè¬å¡èˆ‡æŠ½çåˆ¸')">ğŸ’ èƒŒåŒ…</button>
    </div>

    <div class="warm-marquee">
        <div class="marquee-content" id="marquee-text">
            User888 é€çµ¦ å‹µé¦¨åŸºé‡‘æœƒï¼šè¾›è‹¦äº†ï¼ â¤ï¸ å°åŒ—ç‹å…ˆç”Ÿ ç²å¾— é¼ç‹æ¹¯åº• â¤ï¸ åŒ¿åå‹‡è€… å‰›æŠ•ä¸‹æ„›å¿ƒå¹£...
        </div>
    </div>

    <section id="main-stage">
        <div class="vending-machine" id="machine">
            <div class="machine-title">GIVE CIRCLE 2026</div>
            
            <div class="speech-bubble" id="machine-msg">
                å—¨ï¼æˆ‘é€™è£¡æœ‰å€‹ç¤¾å·¥çš„æ•…äº‹...<br>æŠ•ä¸‹ä¸€æšæ„›å¿ƒï¼Œæˆ‘å°±å‘Šè¨´ä½  â¤ï¸
            </div>

            <div class="glass-window">
                <div class="capsule-deco c1"></div>
                <div class="capsule-deco c2"></div>
                <div class="capsule-deco c3"></div>
            </div>

            <div class="coin-btn" onclick="insertCoin()">â¤ï¸</div>
            <div style="position:absolute; bottom:60px; font-size:10px; color:#fff; opacity:0.8;">ä»Šæ—¥é¡åº¦: <span id="daily-count">3</span>/3</div>

            <div class="take-out-door"></div>
        </div>
    </section>

    <section class="search-area">
        <h3 style="margin:0 0 10px 0; color:#555; font-size:14px;">ğŸ” é‚„æœ‰ 640 å€‹å–®ä½åœ¨ç­‰ä½ </h3>
        <div style="display:flex; justify-content:center;">
            <input type="text" class="search-input" placeholder="æœå°‹å–®ä½åç¨±...">
            <button style="background:#333; color:#fff; border:none; padding:0 15px; border-radius:20px;">Go</button>
        </div>
    </section>

    <div class="footer-area">
        <div class="sponsor-list">
            <span style="border:1px solid #ddd; padding:5px 10px; border-radius:20px; margin:0 5px;">é¼ç‹</span>
            <span style="border:1px solid #ddd; padding:5px 10px; border-radius:20px; margin:0 5px;">è‰¾ç‘ªçµ²</span>
            <span style="border:1px solid #ddd; padding:5px 10px; border-radius:20px; margin:0 5px;">è““æœµå¨œ</span>
        </div>
        <p style="margin-top:15px;">&copy; 2026 GC è´ˆç‰©ç¶² | è®“æ„›å¾ªç’°</p>
        <p style="cursor:pointer; text-decoration:underline;" onclick="alert('é–‹å•Ÿç¤¾å·¥å°ˆå±¬ç™»å…¥å±¤')">ğŸ”’ ç¤¾å·¥å¤¥ä¼´å°ˆå±¬é€šé“</p>
    </div>

    <div id="story-modal" class="capsule-modal">
        <div class="story-card">
            <div class="sc-header">
                <img id="unit-img" class="sc-img" src="">
                <div id="unit-name" class="sc-badge">å–®ä½åç¨±</div>
            </div>

            <div class="sc-body">
                <div id="unit-desc" class="sc-desc"></div>

                <span class="section-title">ğŸ’› ä½ æƒ³æŠŠå“ªä¸€ç¨®å½¢å®¹é€çµ¦ä»–ï¼Ÿ(å¿…é¸)</span>
                <div id="tags-container" class="tag-options"></div>

                <span class="section-title">ğŸ é€å€‹è£œçµ¦å“ (è´ŠåŠ©å•†)ï¼š</span>
                <div class="props-container">
                    <div class="prop-item" onclick="selectProp(this, 'é¼ç‹æ¹¯åº•')">
                        <span class="prop-icon">ğŸ²</span>
                        <span class="prop-name">è£œä¸€é»ç†±</span>
                        <span class="prop-brand">é¼ç‹</span>
                    </div>
                    <div class="prop-item" onclick="selectProp(this, 'è‰¾ç‘ªçµ²æ´—é«®')">
                        <span class="prop-icon">ğŸš¿</span>
                        <span class="prop-name">æ´—å»ç–²æ†Š</span>
                        <span class="prop-brand">è‰¾ç‘ªçµ²</span>
                    </div>
                    <div class="prop-item" onclick="selectProp(this, 'è““æœµå¨œé˜²æ›¬')">
                        <span class="prop-icon">â˜€ï¸</span>
                        <span class="prop-name">æ“‹æ‰æ¶ˆè€—</span>
                        <span class="prop-brand">è““æœµå¨œ</span>
                    </div>
                </div>

                <span class="section-title">ğŸ’Œ å¯«ä¸‹é¼“å‹µï¼š</span>
                <div class="smart-input-area">
                    <div class="smart-btn" onclick="autoFillMsg()">âœ¨ æ²’éˆæ„Ÿï¼Ÿå¹«æˆ‘å¯«</div>
                    <textarea id="msg-input" rows="2" placeholder="èªªé»æº«æš–çš„è©±..."></textarea>
                </div>

                <div style="margin-top:10px; font-size:11px; color:#888; display:flex; justify-content:space-between; align-items:center;">
                    <span>ğŸ“· é™„ä¸Šç…§ç‰‡ (è‹¥ç„¡å‰‡ä½¿ç”¨æš–å¿ƒæ’ç•«)</span>
                    <input type="file" id="upload-photo" style="display:none;" onchange="handlePhoto(this)">
                    <button onclick="document.getElementById('upload-photo').click()" style="border:1px solid #ccc; background:#fff; padding:2px 8px; border-radius:4px;">ä¸Šå‚³</button>
                </div>

                <div id="faction-hint" class="faction-mark"></div>
                <button class="btn-confirm" onclick="generateCard()">â¤ï¸ ç™¼é€ç¥ç¦ (æ¶ˆè€— 1 Energy)</button>
            </div>
        </div>
    </div>

    <div id="preview-modal">
        <div>
            <div id="capture-target">
                <img id="card-final-img" class="polaroid-img" src="">
                <div id="card-stamp" class="stamp"></div>
                <div id="card-msg" class="polaroid-text"></div>
                <div class="polaroid-footer">
                    <span>To: <span id="card-to"></span></span>
                    <span>From: æˆ‘</span>
                </div>
            </div>
            <div style="text-align:center; margin-top:20px;">
                <button onclick="finalSubmit()" style="background:var(--primary); color:#fff; border:none; padding:12px 30px; border-radius:30px; font-weight:bold;">âœ… ç¢ºèªä¸¦ä¸‹è¼‰</button>
                <br><br>
                <span style="color:#fff; text-decoration:underline; font-size:12px;" onclick="document.getElementById('preview-modal').style.display='none'">è¿”å›ä¿®æ”¹</span>
            </div>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒè³‡æ–™ ---
        const units = [
            { 
                name: "å±æ±ä¼¯å¤§å°¼ä¹‹å®¶", 
                img: "https://images.unsplash.com/photo-1469571486292-0ba58a3f068b?w=600", 
                desc: "åœ¨åœ‹å¢ƒä¹‹å—çš„è—å¤©ç™½é›²ä¸‹ï¼Œæˆ‘å€‘æ˜¯ä¸€ç¾¤ã€Œæ…¢é£›å¤©ä½¿ã€çš„å®ˆè­·è€…ã€‚é€™è£¡ä¸åªæ˜¯æ”¶å®¹æ©Ÿæ§‹ï¼Œæ›´æ˜¯ 140 å¤šä½æ†¨å…’æ°¸é çš„å®¶ã€‚å¾è¾²å ´å‹å‹•åˆ°ç”Ÿæ´»è‡ªç†ï¼Œæˆ‘å€‘é™ªè‘—å­©å­å€‘æ…¢æ…¢èµ°ï¼Œé›–ç„¶æ­¥å±¥è¹£è·šï¼Œä½†æ¯ä¸€å€‹å°å°çš„é€²æ­¥ï¼Œéƒ½æ˜¯ç”Ÿå‘½æœ€å …éŸŒçš„è­‰æ˜ã€‚",
                tags: ["#æ†¨å…’å®ˆè­·è€…", "#æ…¢é£›å¤©ä½¿çš„å®¶", "#é™ªä¼´ä¸ç¼ºå¸­"]
            },
            { 
                name: "è¯å±±åŸºé‡‘æœƒ", 
                img: "https://images.unsplash.com/photo-1531206715517-5c0ba140b2b8?w=600", 
                desc: "ç©¿æ¢­åœ¨åé„‰å°å··ï¼Œé‚£ä»¶ç†Ÿæ‚‰çš„èƒŒå¿ƒæ˜¯è¨±å¤šç¨å±…é•·è¼©å”¯ä¸€çš„ç›¼æœ›ã€‚æˆ‘å€‘ä¸åªéé€ç†±é¨°é¨°çš„ä¾¿ç•¶ï¼Œæ›´éé€ã€Œå®¶ã€çš„æ„Ÿè¦ºã€‚ç•¶åŸå¸‚é€æ¼¸è€åŒ–ï¼Œæˆ‘å€‘é¸æ“‡æˆç‚ºé‚£é›™æ‰¶æŒçš„æ‰‹ï¼Œè®“ã€Œè€ã€ä¸å†æ˜¯å­¤ç¨çš„ä»£åè©ï¼Œè€Œæ˜¯è¢«æº«æŸ”å°å¾…çš„æ­²æœˆã€‚",
                tags: ["#é€æ„›åˆ°æ¯å€‹è§’è½", "#ç¨è€ä¾é ", "#æº«æŸ”çš„é˜²ç·š"]
            }
        ];
        
        const smartQuotes = [
            "è¬è¬ä½ å€‘æ¥ä½äº†å—å‚·çš„äººï¼Œè¾›è‹¦äº†ï¼",
            "é›–ç„¶ä¸èªè­˜ä½ ï¼Œä½†è¬è¬ä½ æˆç‚ºé€™åº§åŸå¸‚çš„å…‰ã€‚",
            "é¡˜ä¸–ç•Œå°ä½ å€‘ï¼Œä¹Ÿèƒ½åƒä½ å€‘å°å¾…ä»–äººä¸€æ¨£æº«æŸ”ã€‚",
            "åŠ æ²¹ï¼ä½ å€‘çš„ä»˜å‡ºï¼Œæˆ‘å€‘éƒ½çœ‹åœ¨çœ¼è£¡ã€‚"
        ];

        const defaultIllustrations = [
            "https://images.unsplash.com/photo-1490730141103-6cac27aaab94?w=600", // æš–å¿ƒæ’ç•«1
            "https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=600"  // æš–å¿ƒæ’ç•«2
        ];

        // --- ç‹€æ…‹è®Šæ•¸ ---
        let currentUnit = null;
        let selectedTag = "";
        let selectedProp = "";
        let userPhoto = null;
        let dailyLimit = 3;
        let myTeam = new URLSearchParams(window.location.search).get('team'); // éš±å½¢æˆ°ç·š

        // --- åˆå§‹åŒ– ---
        window.onload = () => {
            if(myTeam) {
                const marquee = document.getElementById('marquee-text');
                marquee.innerText = `ğŸ‘‹ æ­¡è¿ ${myTeam} å¤¥ä¼´åŠ å…¥ï¼ ` + marquee.innerText;
            }
        }

        // --- 1. æŠ•å¹£äº’å‹• ---
        function insertCoin() {
            if(dailyLimit <= 0) return alert("ä»Šæ—¥æ„›å¿ƒèƒ½é‡å·²ç”¨å®Œï¼Œè«‹æ˜å¤©å†ä¾†ï¼");
            
            // å‹•ç•«ï¼šæŠ•å¹£
            const btn = document.querySelector('.coin-btn');
            btn.style.transform = "translateX(-50%) translateY(200px) scale(0.1)";
            btn.style.opacity = "0";

            // æ©Ÿå°æŠ–å‹•å‹•ç•«
            const machine = document.getElementById('machine');
            machine.style.animation = "shake 0.5s ease-in-out";
            
            // éš¨æ©ŸæŠ½é¸å–®ä½
            setTimeout(() => {
                currentUnit = units[Math.floor(Math.random() * units.length)];
                showStoryCard(currentUnit);
                
                // é‡ç½®æŒ‰éˆ•ç‹€æ…‹ (ç‚ºäº†ä¸‹ä¸€æ¬¡)
                setTimeout(() => {
                    btn.style.transform = "translateX(-50%) scale(1)";
                    btn.style.opacity = "1";
                    machine.style.animation = "";
                }, 1000);
            }, 800);
        }

        // --- 2. é¡¯ç¤ºæ•…äº‹å¡ç‰‡ (è† å›Šæ‰“é–‹) ---
        function showStoryCard(unit) {
            document.getElementById('unit-img').src = unit.img;
            document.getElementById('unit-name').innerText = unit.name;
            document.getElementById('unit-desc').innerText = unit.desc;
            
            // ç”Ÿæˆæ¨™ç±¤
            const tagContainer = document.getElementById('tags-container');
            tagContainer.innerHTML = "";
            unit.tags.forEach(tag => {
                const el = document.createElement('div');
                el.className = 'tag-opt';
                el.innerText = tag;
                el.onclick = () => {
                    document.querySelectorAll('.tag-opt').forEach(t => t.classList.remove('active'));
                    el.classList.add('active');
                    selectedTag = tag;
                }
                tagContainer.appendChild(el);
            });

            // éš±å½¢æˆ°ç·šæç¤º
            if(myTeam) {
                const hint = document.getElementById('faction-hint');
                hint.style.display = 'block';
                hint.innerText = `ğŸ›¡ï¸ æœ¬æ¬¡ç¥ç¦å°‡è¨ˆå…¥ã€${myTeam}ã€‘æˆ°éšŠç©åˆ†`;
            }

            document.getElementById('story-modal').style.display = 'flex';
        }

        // --- 3. äº’å‹•åŠŸèƒ½ ---
        function selectProp(el, name) {
            document.querySelectorAll('.prop-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            selectedProp = name;
        }

        function autoFillMsg() {
            const msg = smartQuotes[Math.floor(Math.random() * smartQuotes.length)];
            document.getElementById('msg-input').value = msg;
        }

        function handlePhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) { userPhoto = e.target.result; alert("ç…§ç‰‡å·²ä¸Šå‚³ï¼"); }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- 4. ç”Ÿæˆé è¦½ (æ‹ç«‹å¾—) ---
        function generateCard() {
            const msg = document.getElementById('msg-input').value;
            if(!selectedTag) return alert("è«‹é¸æ“‡ä¸€å€‹å½¢å®¹è©æ¨™ç±¤ï¼");
            if(!msg) return alert("è«‹å¯«ä¸‹ä¸€å¥ç¥ç¦ï¼ˆæˆ–é»æ“Šè‡ªå‹•å¡«å¯«ï¼‰ï¼");

            // è™•ç†åœ–ç‰‡ï¼šç„¡ä¸Šå‚³å‰‡éš¨æ©Ÿç”¨æ’ç•«
            const finalPhoto = userPhoto || defaultIllustrations[Math.floor(Math.random() * defaultIllustrations.length)];
            
            document.getElementById('card-final-img').src = finalPhoto;
            document.getElementById('card-msg').innerText = msg;
            document.getElementById('card-to').innerText = currentUnit.name;
            
            const stamp = document.getElementById('card-stamp');
            if(selectedProp) {
                stamp.style.display = 'block';
                stamp.innerText = `ğŸ è´ˆé€ ${selectedProp}`;
            } else {
                stamp.style.display = 'none';
            }

            document.getElementById('story-modal').style.display = 'none';
            document.getElementById('preview-modal').style.display = 'flex';
        }

        // --- 5. æœ€çµ‚é€å‡º ---
        function finalSubmit() {
            dailyLimit--;
            document.getElementById('daily-count').innerText = dailyLimit;
            
            // é€™è£¡å¯ä»¥åŠ å…¥ html2canvas ä¸‹è¼‰é‚è¼¯
            alert("âœ… ç™¼é€æˆåŠŸï¼å‹‡è€…èƒŒåŒ…å·²æ›´æ–°ï¼Œæ„Ÿè¬æ‚¨çš„æ„›å¿ƒï¼");
            
            document.getElementById('preview-modal').style.display = 'none';
            
            // å›åˆ°è²©è³£æ©Ÿï¼Œé¡¯ç¤ºæ„Ÿè¬æ°£æ³¡
            const bubble = document.getElementById('machine-msg');
            bubble.innerHTML = "æ”¶åˆ°ä½ çš„æ„›å¿ƒäº†ï¼<br>ä¸–ç•Œä¸Šåˆå¤šäº†ä¸€ä»½æº«æš– âœ¨";
        }
        
        // CSS Animation Helper
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes shake {
                0% { transform: translate(1px, 1px) rotate(0deg); }
                10% { transform: translate(-1px, -2px) rotate(-1deg); }
                20% { transform: translate(-3px, 0px) rotate(1deg); }
                30% { transform: translate(3px, 2px) rotate(0deg); }
                40% { transform: translate(1px, -1px) rotate(1deg); }
                50% { transform: translate(-1px, 2px) rotate(-1deg); }
                60% { transform: translate(-3px, 1px) rotate(0deg); }
                100% { transform: translate(0, 0) rotate(0deg); }
            }
        `;
        document.head.appendChild(styleSheet);

    </script>
</body>
</html>
