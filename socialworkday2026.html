<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 çµ¦ç¤¾å·¥æ„›çš„é¼“å‹µ - æº«æš–æŠ•éæ‰€</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Press+Start+2P&family=Noto+Serif+TC:wght@600&display=swap" rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            /* æº«æš–é…è‰²ç³»çµ± */
            --primary: #FF7043;      /* æš–ç£šç´… */
            --accent: #FFCA28;       /* éƒµç­’é»ƒ */
            --bg-soft: #FFF3E0;      /* ç±³é»ƒåº• */
            --text-main: #3E2723;    /* æ·±å’–å­— */
            --card-bg: #FFFFFF;      /* ä¿¡ç´™ç™½ */
            --machine-shadow: #BF360C;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; font-family: 'Noto Sans TC', sans-serif; 
            color: var(--text-main); background-color: var(--bg-soft); 
            overflow-x: hidden;
        }

        /* --- é ‚éƒ¨å°èˆª --- */
        .nav-bar { 
            position: fixed; top: 0; left: 0; width: 100%; z-index: 100;
            padding: 10px 15px; background: rgba(255,255,255,0.9); backdrop-filter: blur(5px);
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .global-status { font-size: 10px; font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 5px; }
        .energy-bar-mini { width: 80px; height: 6px; background: #eee; border-radius: 3px; overflow: hidden; }
        .energy-fill-mini { width: 78%; height: 100%; background: linear-gradient(90deg, var(--accent), var(--primary)); }
        
        .btn-inventory {
            background: var(--text-main); color: #fff; border: none; padding: 6px 12px;
            border-radius: 20px; font-size: 11px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 5px; transition: 0.2s;
        }
        .btn-inventory:hover { transform: scale(1.05); background: var(--primary); }

        /* --- è·‘é¦¬ç‡ˆ (ç½®æ–¼ Hero ä¸‹æ–¹ï¼Œæ•´åˆæ„Ÿ) --- */
        .marquee-wrapper {
            background: var(--text-main); color: var(--accent); padding: 8px 0;
            overflow: hidden; white-space: nowrap; font-size: 11px; font-family: 'Noto Sans TC';
        }
        .marquee-content { display: inline-block; padding-left: 100%; animation: ticker 30s linear infinite; }
        @keyframes ticker { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }

        /* --- Hero Section --- */
        #hero-section {
            padding-top: 60px; min-height: 40vh; /* ç¸®æ¸›é«˜åº¦ï¼Œè®“æ©Ÿå°æ›´å¿«å‡ºç¾ */
            background: linear-gradient(rgba(255, 243, 224, 0.9), rgba(255, 243, 224, 1)), url('https://images.unsplash.com/photo-1544027993-37dbfe43562a?auto=format&fit=crop&w=1600&q=80');
            background-size: cover; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .hero-title { font-size: 1.8rem; font-weight: 700; color: var(--text-main); margin-bottom: 10px; }
        .hero-desc { font-size: 0.9rem; color: #666; max-width: 80%; line-height: 1.6; margin-bottom: 20px; }

        /* --- Game Section: æº«æš–æŠ•éæ‰€ --- */
        #game-section {
            padding: 20px; display: flex; flex-direction: column; align-items: center; position: relative;
            min-height: 600px;
        }

        /* æ©Ÿå°æœ¬é«”ï¼šè¨­è¨ˆæˆéƒµç­’/è²©è³£æ©Ÿé¢¨æ ¼ */
        .machine-body {
            width: 100%; max-width: 360px; background: var(--primary);
            border-radius: 30px 30px 10px 10px; padding: 20px;
            box-shadow: 0 10px 0 var(--machine-shadow), 0 20px 30px rgba(0,0,0,0.2);
            position: relative; z-index: 10; transition: transform 0.2s;
        }
        
        /* é¡¯ç¤ºè¢å¹• (Idle ç‹€æ…‹) */
        .screen-display {
            background: #fff; border-radius: 15px; height: 320px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; overflow: hidden; border: 4px solid rgba(255,255,255,0.3);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
        
        .idle-content { text-align: center; animation: float 3s infinite ease-in-out; }
        .idle-icon { font-size: 60px; margin-bottom: 10px; display: block; }
        .idle-text { font-size: 14px; font-weight: bold; color: var(--text-main); line-height: 1.5; }
        @keyframes float { 0%,100% {transform:translateY(0);} 50% {transform:translateY(-5px);} }

        /* æŠ•å¹£äº’å‹•å€ */
        .coin-interaction {
            margin-top: 25px; display: flex; flex-direction: column; align-items: center; height: 120px; position: relative;
        }
        .coin-slot { width: 120px; height: 12px; background: #3E2723; border-radius: 6px; margin-top: auto; position: relative; }
        .coin-slot::after { content:''; width:100%; height:2px; background:#5D4037; position:absolute; bottom:0; left:0; border-radius:6px; }

        .coin-btn {
            width: 70px; height: 70px; background: var(--accent); border-radius: 50%;
            border: 3px solid #FFF8E1; display: flex; align-items: center; justify-content: center;
            font-size: 32px; color: var(--primary); cursor: pointer;
            box-shadow: 0 4px 0 #FFA000, 0 5px 10px rgba(0,0,0,0.2);
            position: absolute; top: 0; animation: pulse 2s infinite; z-index: 20;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .coin-btn:active { transform: scale(0.95); box-shadow: 0 2px 0 #FFA000; }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.05);} 100% {transform: scale(1);} }

        /* --- æ²‰æµ¸å¼ä¿¡ä»¶ (å–ä»£é•·æ¢é é¢) --- */
        /* é€™æ˜¯ä¸€å€‹è¦†è“‹å±¤ï¼Œç•¶æŠ•å¹£å¾Œæ»‘å‡ºï¼Œæ„Ÿè¦ºåƒæ”¶åˆ°ä¸€å°ä¿¡ */
        .letter-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 50; display: none; /* åˆå§‹éš±è— */
            align-items: center; justify-content: center; padding: 20px;
            opacity: 0; transition: opacity 0.5s;
        }
        
        .letter-card {
            background: #fff; width: 100%; max-width: 400px; max-height: 90vh;
            border-radius: 4px; box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow-y: auto; display: flex; flex-direction: column;
            transform: translateY(50px); transition: transform 0.5s;
            position: relative;
        }
        /* ä¿¡ç´™ç´‹è·¯è£é£¾ */
        .letter-card::before {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px;
            background: repeating-linear-gradient(45deg, var(--primary) 0, var(--primary) 10px, #fff 10px, #fff 20px, #3E4684 20px, #3E4684 30px, #fff 30px, #fff 40px);
        }

        .letter-header { position: relative; height: 200px; flex-shrink: 0; }
        .letter-img { width: 100%; height: 100%; object-fit: cover; filter: sepia(20%); }
        .letter-stamp {
            position: absolute; bottom: -15px; right: 20px; width: 60px; height: 60px;
            background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); font-size: 30px; border: 2px solid #eee;
        }

        .letter-body { padding: 30px 20px 20px 20px; color: var(--text-main); }
        .unit-name { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; color: var(--primary); }
        .story-text { 
            font-family: 'Noto Serif TC', serif; font-size: 0.95rem; line-height: 1.8; text-align: justify; 
            margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px dashed #ddd;
        }

        /* äº’å‹•é¸é …è¨­è¨ˆæˆã€Œå›ä¿¡ã€çš„æ„Ÿè¦º */
        .interaction-group { margin-bottom: 20px; }
        .group-label { font-size: 11px; font-weight: bold; color: #999; margin-bottom: 8px; display: block; text-transform: uppercase; letter-spacing: 1px; }
        
        .chips-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
        .chip { 
            white-space: nowrap; padding: 6px 14px; border: 1px solid #ddd; border-radius: 20px; 
            font-size: 12px; color: #666; cursor: pointer; transition: 0.2s; background: #fafafa;
        }
        .chip.active { background: var(--primary); color: #fff; border-color: var(--primary); }

        .props-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; }
        .prop-card {
            min-width: 90px; border: 1px solid #eee; border-radius: 8px; padding: 10px;
            text-align: center; background: #fff; cursor: pointer; transition: 0.2s;
        }
        .prop-card.selected { border: 2px solid var(--accent); background: #FFFDE7; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        .smart-textarea-wrapper { position: relative; }
        .magic-btn { 
            position: absolute; right: 8px; top: 8px; background: #f0f0f0; padding: 2px 8px; 
            border-radius: 4px; font-size: 10px; color: #666; cursor: pointer; border: 1px solid #ccc;
        }
        textarea { width: 100%; border: 1px solid #ddd; border-radius: 6px; padding: 12px; font-family: inherit; font-size: 13px; resize: none; background: #FAFAFA; }

        .upload-row { display: flex; align-items: center; justify-content: space-between; font-size: 11px; color: #888; margin-top: 5px; }
        .btn-upload-text { text-decoration: underline; cursor: pointer; }

        .btn-send {
            width: 100%; background: var(--primary); color: #fff; border: none; padding: 15px;
            font-size: 14px; font-weight: bold; border-radius: 4px; cursor: pointer;
            box-shadow: 0 4px 0 #D84315; margin-top: 10px; display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .btn-send:active { transform: translateY(4px); box-shadow: none; }

        .faction-tag { font-size: 10px; color: #aaa; text-align: center; margin-top: 10px; display: none; }

        /* --- Footer & Search --- */
        #search-section { padding: 40px 20px; background: #ECEFF1; text-align: center; }
        .sponsor-bar { display: flex; justify-content: center; gap: 15px; margin: 20px 0; opacity: 0.6; }
        .sponsor-logo { font-size: 10px; border: 1px solid #999; padding: 2px 8px; border-radius: 10px; }
        
        /* Modals (èƒŒåŒ…, é è¦½, ç¤¾å·¥) - ä¿æŒåŸæœ‰åŠŸèƒ½ä½†ç¾åŒ– */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 200; align-items: center; justify-content: center; padding: 20px; }
        
        /* æ‹ç«‹å¾—é è¦½æ¨£å¼ */
        #capture-target { 
            background: #fff; padding: 15px 15px 50px 15px; width: 300px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); transform: rotate(-2deg);
        }
        .polaroid-img { width: 100%; height: 240px; object-fit: cover; background: #eee; margin-bottom: 15px; filter: contrast(1.1); }
        .polaroid-msg { font-family: 'Noto Serif TC'; font-size: 14px; color: #333; line-height: 1.6; min-height: 40px; }
        .polaroid-meta { position: absolute; bottom: 15px; left: 15px; right: 15px; display: flex; justify-content: space-between; font-size: 10px; color: #999; font-family: 'Noto Sans TC'; }
        .stamp-prop { position: absolute; bottom: 60px; right: 20px; border: 2px solid var(--primary); color: var(--primary); padding: 4px 8px; font-size: 10px; font-weight: bold; transform: rotate(-15deg); border-radius: 4px; background: rgba(255,255,255,0.8); }

        /* Inventory */
        .inventory-box { background: #fff; width: 100%; max-width: 400px; height: 75vh; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; }
        .inventory-header { background: var(--text-main); color: #fff; padding: 15px; display: flex; justify-content: space-between; }
        .inventory-list { padding: 15px; overflow-y: auto; flex: 1; background: #f5f5f5; }
        .ticket-card { background: #fff; padding: 15px; margin-bottom: 10px; border-radius: 4px; border-left: 4px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        /* SW Modal */
        .sw-box { background: #fff; width: 100%; max-width: 500px; padding: 30px; border-radius: 10px; text-align: center; font-family: 'Noto Serif TC'; }
        .sw-photo { width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 20px; filter: sepia(20%); }

    </style>
</head>
<body>

    <div class="nav-bar">
        <div class="global-status">
            <span>â¤ï¸ LV.78</span>
            <div class="energy-bar-mini"><div class="energy-fill-mini"></div></div>
        </div>
        <button class="btn-inventory" onclick="openInventory()">ğŸ’ èƒŒåŒ…</button>
    </div>

    <div style="padding-top: 60px;"></div>
    <div class="marquee-wrapper">
        <div class="marquee-content" id="marquee-text">
            User888 å‰›å‰›ç‚º è¯å±±åŸºé‡‘æœƒ åŠ æ²¹  â¤ï¸  ç‹å°æ˜ ç²å¾— é¼ç‹æ¹¯åº•  â¤ï¸  åŒ¿åå‹‡è€… å‰›æŠ•ä¸‹æ„›å¿ƒå¹£...
        </div>
    </div>

    <section id="hero-section">
        <div style="background:var(--accent); padding:2px 10px; border-radius:15px; font-size:0.8rem; font-weight:bold; margin-bottom:10px;">2026 ç¬¬ä¸ƒå±†</div>
        <h1 class="hero-title">çµ¦ç¤¾å·¥æ„›çš„é¼“å‹µ</h1>
        <p class="hero-desc">æœ‰äº›äººï¼Œé•·æœŸç«™åœ¨æœ€å‰ç·šå»å¾ˆå°‘è¢«å•ä¸€å¥ã€Œä½ é‚„å¥½å—ï¼Ÿã€<br>ä»Šå¤©ï¼Œæ›æˆ‘å€‘ä¾†ç…§é¡§ä»–å€‘ã€‚</p>
        <div style="font-size:0.7rem; color:#fff; background:rgba(0,0,0,0.3); padding:5px 10px; border-radius:20px;">
            é”æˆç›®æ¨™åŠ ç¢¼ï¼šå…¨å°ç¤¾å·¥æ¯äººä¸€æ¯ç†±å’–å•¡ â˜•
        </div>
    </section>

    <section id="game-section">
        
        <div class="daily-limit-badge" style="margin-bottom:10px; font-size:10px; color:#888;">
            ä»Šæ—¥æ„›å¿ƒé¡åº¦ï¼š<span id="daily-display">3</span> / 3
        </div>

        <div class="machine-body" id="machine">
            <div class="screen-display">
                <div class="idle-content">
                    <div class="idle-icon">ğŸ“®</div>
                    <div class="idle-text">é€™è£¡æœ‰ä¸€å°<br>ç¤¾å·¥çš„æ•…äº‹...<br><br><span style="font-size:12px; color:#999; font-weight:normal;">æŠ•ä¸‹æ„›å¿ƒé–‹å•Ÿ</span></div>
                </div>
            </div>

            <div class="coin-interaction">
                <div class="coin-btn" onclick="insertCoin()">â¤ï¸</div>
                <div class="coin-slot"></div>
            </div>
        </div>

    </section>

    <div id="letter-overlay" class="letter-overlay">
        <div class="letter-card">
            
            <div class="letter-header">
                <img id="unit-img" class="letter-img" src="">
                <div class="letter-stamp">â¤ï¸</div>
            </div>

            <div class="letter-body">
                <div id="unit-name" class="unit-name">å–®ä½åç¨±</div>
                <div id="unit-desc" class="story-text">
                    </div>

                <div class="interaction-group">
                    <label class="group-label">1. é€çµ¦ä»–çš„å½¢å®¹è©</label>
                    <div id="tags-wrapper" class="chips-scroll"></div>
                </div>

                <div class="interaction-group">
                    <label class="group-label">2. é¸æ“‡è£œçµ¦å“ (è´ŠåŠ©)</label>
                    <div class="props-scroll">
                        <div class="prop-card" onclick="selectProp(this, 'é¼ç‹æ¹¯åº•', 'ğŸ²')">
                            <div style="font-size:20px;">ğŸ²</div>
                            <div style="font-size:10px; font-weight:bold; margin-top:5px;">è£œä¸€é»ç†±</div>
                            <div style="font-size:9px; color:#999;">é¼ç‹</div>
                        </div>
                        <div class="prop-card" onclick="selectProp(this, 'è‰¾ç‘ªçµ²æ´—é«®', 'ğŸš¿')">
                            <div style="font-size:20px;">ğŸš¿</div>
                            <div style="font-size:10px; font-weight:bold; margin-top:5px;">æ´—å»ç–²æ†Š</div>
                            <div style="font-size:9px; color:#999;">è‰¾ç‘ªçµ²</div>
                        </div>
                        <div class="prop-card" onclick="selectProp(this, 'è““æœµå¨œé˜²æ›¬', 'â˜€ï¸')">
                            <div style="font-size:20px;">â˜€ï¸</div>
                            <div style="font-size:10px; font-weight:bold; margin-top:5px;">æ“‹æ‰æ¶ˆè€—</div>
                            <div style="font-size:9px; color:#999;">è““æœµå¨œ</div>
                        </div>
                    </div>
                </div>

                <div class="interaction-group">
                    <label class="group-label">3. å¯«ä¸‹é¼“å‹µ</label>
                    <div class="smart-textarea-wrapper">
                        <textarea id="msg-input" rows="3" placeholder="å¯«äº›æº«æš–çš„è©±..."></textarea>
                        <div class="magic-btn" onclick="autoFillMsg()">âœ¨ å¹«æˆ‘å¯«</div>
                    </div>
                    <div class="upload-row">
                        <span>ğŸ“· é™„ä¸Šç…§ç‰‡ (é è¨­ç‚ºæš–å¿ƒæ’åœ–)</span>
                        <span class="btn-upload-text" onclick="document.getElementById('upload-photo').click()">ä¸Šå‚³ç…§ç‰‡</span>
                        <input type="file" id="upload-photo" style="display:none;" accept="image/*" onchange="previewUserPhoto()">
                    </div>
                    <div id="file-status" style="font-size:10px; color:var(--primary); text-align:right;"></div>
                </div>

                <div id="faction-hint" class="faction-tag"></div>
                
                <button class="btn-send" onclick="generateCard()">
                    <span>âœ‰ï¸ è“‹ç« é€å‡º</span>
                </button>
                
                <div style="text-align:center; margin-top:10px;">
                    <span style="font-size:11px; color:#999; text-decoration:underline; cursor:pointer;" onclick="closeLetter()">æš«æ™‚é›¢é–‹</span>
                </div>
            </div>
        </div>
    </div>


    <section id="search-section">
        <h3 style="margin:0 0 10px 0; color:#555; font-size:1.1rem;">ğŸ” é‚„æœ‰ 640 å€‹å–®ä½åœ¨ç­‰ä½ </h3>
        <div style="display:flex; justify-content:center; gap:5px;">
            <input type="text" placeholder="ä¾‹å¦‚ï¼šå‹µé¦¨ã€èŠ’è‰å¿ƒ..." style="padding:10px; border:1px solid #ccc; border-radius:4px; width:60%;">
            <button onclick="alert('é–‹å•Ÿæœå°‹æµç¨‹')" style="padding:10px 20px; background:#333; color:#fff; border:none; border-radius:4px;">Go</button>
        </div>
    </section>

    <div style="text-align:center; padding:30px; background:#fff; font-size:11px; color:#999;">
        <div class="sponsor-bar" style="margin-bottom:15px; display:flex; justify-content:center; gap:10px;">
            <span class="sponsor-logo" style="border:1px solid #ddd; padding:2px 8px; border-radius:10px;">é¼ç‹</span>
            <span class="sponsor-logo" style="border:1px solid #ddd; padding:2px 8px; border-radius:10px;">è‰¾ç‘ªçµ²</span>
            <span class="sponsor-logo" style="border:1px solid #ddd; padding:2px 8px; border-radius:10px;">è““æœµå¨œ</span>
        </div>
        &copy; 2026 GC è´ˆç‰©ç¶² | è®“æ„›å¾ªç’°<br>
        <span onclick="openSWLayer()" style="cursor:pointer; text-decoration:underline; margin-top:10px; display:inline-block;">ğŸ”’ ç¤¾å·¥å¤¥ä¼´å°ˆå±¬é€šé“</span>
    </div>

    <div id="preview-modal" class="modal-overlay">
        <div style="text-align:center;">
            <div id="capture-target">
                <img id="card-final-img" class="polaroid-img" src="">
                <div id="card-stamp" class="stamp-prop" style="display:none;"></div>
                <div id="card-msg" class="polaroid-msg"></div>
                <div class="polaroid-meta">
                    <span>To: <span id="card-to"></span></span>
                    <span>From: <span id="card-from">æˆ‘</span></span>
                </div>
            </div>
            <div style="margin-top:20px; display:flex; flex-direction:column; gap:10px; width:300px; margin-left:auto; margin-right:auto;">
                <button onclick="confirmSubmit()" style="background:var(--primary); color:#fff; border:none; padding:12px; border-radius:30px; font-weight:bold; box-shadow:0 4px 10px rgba(0,0,0,0.2);">âœ… ç¢ºèªä¸¦é ˜å–æŠ½çåˆ¸</button>
                <button onclick="closeModal('preview-modal')" style="background:transparent; color:#fff; border:1px solid #fff; padding:10px; border-radius:30px;">è¿”å›ä¿®æ”¹</button>
            </div>
        </div>
    </div>

    <div id="inventory-modal" class="modal-overlay">
        <div class="inventory-box">
            <div class="inventory-header">
                <span>ğŸ’ å‹‡è€…èƒŒåŒ…</span>
                <span style="cursor:pointer;" onclick="closeModal('inventory-modal')">Ã—</span>
            </div>
            <div class="inventory-list" id="inventory-list"></div>
        </div>
    </div>

    <div id="sw-modal" class="modal-overlay">
        <div class="sw-box">
            <div style="text-align:right;"><span style="cursor:pointer; color:#999;" onclick="closeModal('sw-modal')">Ã—</span></div>
            <img src="https://images.unsplash.com/photo-1516733968668-dbdce39c46ef?auto=format&fit=crop&w=800&q=80" class="sw-photo">
            <div style="font-size:1.5rem; font-weight:bold; margin-bottom:10px; color:var(--text-main);">è‡´ è¦ªæ„›çš„å¤¥ä¼´</div>
            <div style="font-size:1rem; line-height:1.6; color:#555; text-align:justify; margin-bottom:20px;">
                é€™ä»½ç¥ç¦ä¾†è‡ªå…¨å°è§’è½ï¼Œæ¯ä¸€æšæŠ•ä¸‹çš„æ„›å¿ƒå¹£ï¼Œéƒ½æ‰¿è¼‰è‘—æ°‘çœ¾å°ä½ çš„æ·±åˆ‡è¬æ„ã€‚åœ¨ç¹å¿™çš„è¨ªè¦–èˆ‡å€‹æ¡ˆç´€éŒ„é–“ï¼Œè«‹åˆ¥å¿˜äº†ï¼Œ<span style="background:#FFF3E0; color:var(--primary); font-weight:bold; padding:0 5px;">æœ‰äººæ­£é»˜é»˜åœä¸‹ä¾†ç‚ºä½ æ‰“æ°£</span>ã€‚
            </div>
            <div style="text-align:left; background:#f9f9f9; padding:15px; border-radius:8px;">
                <h4 style="margin:0 0 10px 0; font-size:13px;">ğŸ† é—œéµå­—æ’è¡Œï¼š</h4>
                <div style="font-size:12px; margin-bottom:5px;">1. è¾›è‹¦äº† (3,240)</div>
                <div style="font-size:12px;">2. æ¥ä½å—å‚·çš„äºº (2,105)</div>
            </div>
        </div>
    </div>

    <script>
        // Data
        const units = [
            { 
                name: "å±æ±ä¼¯å¤§å°¼ä¹‹å®¶", 
                img: "https://images.unsplash.com/photo-1469571486292-0ba58a3f068b?w=600", 
                desc: "åœ¨åœ‹å¢ƒä¹‹å—çš„è—å¤©ç™½é›²ä¸‹ï¼Œæˆ‘å€‘æ˜¯ä¸€ç¾¤ã€Œæ…¢é£›å¤©ä½¿ã€çš„å®ˆè­·è€…ã€‚é€™è£¡ä¸åªæ˜¯æ”¶å®¹æ©Ÿæ§‹ï¼Œæ›´æ˜¯ 140 å¤šä½æ†¨å…’æ°¸é çš„å®¶ã€‚å¾è¾²å ´å‹å‹•åˆ°ç”Ÿæ´»è‡ªç†ï¼Œæˆ‘å€‘é™ªè‘—å­©å­å€‘æ…¢æ…¢èµ°ã€‚",
                tags: ["#æ†¨å…’å®ˆè­·è€…", "#æ…¢é£›å¤©ä½¿", "#é™ªä¼´ä¸ç¼ºå¸­"]
            },
            { 
                name: "è¯å±±åŸºé‡‘æœƒ", 
                img: "https://images.unsplash.com/photo-1531206715517-5c0ba140b2b8?w=600", 
                desc: "ç©¿æ¢­åœ¨åé„‰å°å··ï¼Œé‚£ä»¶ç†Ÿæ‚‰çš„èƒŒå¿ƒæ˜¯è¨±å¤šç¨å±…é•·è¼©å”¯ä¸€çš„ç›¼æœ›ã€‚æˆ‘å€‘ä¸åªéé€ç†±é¨°é¨°çš„ä¾¿ç•¶ï¼Œæ›´éé€ã€Œå®¶ã€çš„æ„Ÿè¦ºã€‚ç•¶åŸå¸‚é€æ¼¸è€åŒ–ï¼Œæˆ‘å€‘é¸æ“‡æˆç‚ºé‚£é›™æ‰¶æŒçš„æ‰‹ã€‚",
                tags: ["#é€æ„›åˆ°è§’è½", "#ç¨è€ä¾é ", "#æº«æŸ”é˜²ç·š"]
            }
        ];
        const defaultIllustrations = ["https://images.unsplash.com/photo-1490730141103-6cac27aaab94?w=600", "https://images.unsplash.com/photo-1518199266791-5375a83190b7?w=600"];
        const smartQuotes = ["è¬è¬ä½ å€‘æ¥ä½äº†å—å‚·çš„äººã€‚", "è¾›è‹¦äº†ï¼å¸Œæœ›ä¸–ç•Œå°ä½ å€‘ä¹Ÿèƒ½æº«æŸ”ä¸€é»ã€‚", "åŠ æ²¹ï¼ä½ å€‘çš„ä»˜å‡ºæˆ‘å€‘éƒ½çœ‹åœ¨çœ¼è£¡ã€‚"];

        // State
        let currentUnit = null;
        let selectedTag = null;
        let selectedProp = null;
        let userPhoto = null;
        let dailyCount = 0;
        let myTeam = new URLSearchParams(window.location.search).get('team');

        // Init
        window.onload = function() {
            checkDailyLimit();
            if(myTeam) {
                document.getElementById('faction-hint').style.display = 'block';
                document.getElementById('faction-hint').innerText = `ğŸ›¡ï¸ æœ¬æ¬¡ç¥ç¦å°‡è¨ˆå…¥ã€${myTeam}ã€‘æˆ°éšŠç©åˆ†`;
                const mq = document.getElementById('marquee-text');
                mq.innerText = `ğŸ‘‹ æ­¡è¿ ${myTeam} å¤¥ä¼´åŠ å…¥å®ˆè­·ï¼ ` + mq.innerText;
            }
        }

        function checkDailyLimit() {
            const today = new Date().toLocaleDateString();
            if(localStorage.getItem('gc_last_date') !== today) {
                localStorage.setItem('gc_last_date', today);
                localStorage.setItem('gc_daily_count', 0);
                dailyCount = 0;
            } else {
                dailyCount = parseInt(localStorage.getItem('gc_daily_count') || 0);
            }
            updateDailyDisplay();
        }

        function updateDailyDisplay() {
            const left = Math.max(0, 3 - dailyCount);
            document.getElementById('daily-display').innerText = left;
        }

        // Action 1: Insert Coin
        function insertCoin() {
            if(dailyCount >= 3) return alert("ä»Šæ—¥æ„›å¿ƒé¡åº¦å·²ç”¨å®Œï¼Œæ˜å¤©å†ä¾†å§ï¼");

            const btn = document.querySelector('.coin-btn');
            const machine = document.querySelector('.machine-body');
            
            // Animation
            btn.style.transform = "translateY(150px) scale(0.1)";
            btn.style.opacity = "0";
            machine.style.transform = "scale(0.98)";
            setTimeout(() => machine.style.transform = "scale(1)", 100);

            setTimeout(() => {
                // Pick Unit & Show Letter
                currentUnit = units[Math.floor(Math.random() * units.length)];
                renderLetter(currentUnit);
                
                const overlay = document.getElementById('letter-overlay');
                overlay.style.display = 'flex';
                setTimeout(() => {
                    overlay.style.opacity = 1;
                    document.querySelector('.letter-card').style.transform = "translateY(0)";
                }, 10);

                // Reset Coin
                setTimeout(() => {
                    btn.style.transform = "scale(1)";
                    btn.style.opacity = "1";
                }, 500);
            }, 600);
        }

        function renderLetter(unit) {
            document.getElementById('unit-img').src = unit.img;
            document.getElementById('unit-name').innerText = unit.name;
            document.getElementById('unit-desc').innerText = unit.desc;
            
            const wrapper = document.getElementById('tags-wrapper');
            wrapper.innerHTML = "";
            unit.tags.forEach(tag => {
                const el = document.createElement('div');
                el.className = 'chip';
                el.innerText = tag;
                el.onclick = () => {
                    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
                    el.classList.add('active');
                    selectedTag = tag;
                }
                wrapper.appendChild(el);
            });
        }

        function closeLetter() {
            const overlay = document.getElementById('letter-overlay');
            overlay.style.opacity = 0;
            document.querySelector('.letter-card').style.transform = "translateY(50px)";
            setTimeout(() => overlay.style.display = 'none', 500);
        }

        // Action 2: Interact
        function selectProp(el, name) {
            document.querySelectorAll('.prop-card').forEach(p => p.classList.remove('selected'));
            el.classList.add('selected');
            selectedProp = name;
        }

        function autoFillMsg() {
            document.getElementById('msg-input').value = smartQuotes[Math.floor(Math.random() * smartQuotes.length)];
        }

        function previewUserPhoto() {
            const file = document.getElementById('upload-photo').files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (e) => { 
                    userPhoto = e.target.result; 
                    document.getElementById('file-status').innerText = "âœ… å·²é¸ç…§ç‰‡";
                }
                reader.readAsDataURL(file);
            }
        }

        // Action 3: Generate Card
        function generateCard() {
            const msg = document.getElementById('msg-input').value;
            if(!selectedTag) return alert("è«‹é¸æ“‡ä¸€å€‹å½¢å®¹è©ï¼");
            if(!msg) return alert("è«‹å¯«ä¸‹ä¸€å¥é¼“å‹µï¼");

            const finalImg = userPhoto || defaultIllustrations[Math.floor(Math.random() * defaultIllustrations.length)];
            
            document.getElementById('card-final-img').src = finalImg;
            document.getElementById('card-msg').innerText = msg;
            document.getElementById('card-to').innerText = currentUnit.name;
            
            if(selectedProp) {
                document.getElementById('card-stamp').style.display = 'block';
                document.getElementById('card-stamp').innerText = `ğŸ è´ˆé€ ${selectedProp}`;
            } else {
                document.getElementById('card-stamp').style.display = 'none';
            }

            closeLetter();
            document.getElementById('preview-modal').style.display = 'flex';
        }

        function confirmSubmit() {
            dailyCount++;
            localStorage.setItem('gc_daily_count', dailyCount);
            updateDailyDisplay();
            
            saveRecord();
            alert("âœ… ç™¼é€æˆåŠŸï¼æŠ½çåˆ¸å·²å­˜å…¥èƒŒåŒ…ï¼");
            closeModal('preview-modal');
        }

        function saveRecord() {
            const records = JSON.parse(localStorage.getItem('gc_records') || "[]");
            records.unshift({
                id: `TICKET-${Date.now().toString().slice(-4)}`,
                unit: currentUnit.name,
                msg: document.getElementById('msg-input').value,
                prop: selectedProp || "ç„¡"
            });
            localStorage.setItem('gc_records', JSON.stringify(records));
        }

        // Inventory Logic
        function openInventory() {
            const list = document.getElementById('inventory-list');
            const records = JSON.parse(localStorage.getItem('gc_records') || "[]");
            list.innerHTML = "";
            if(records.length === 0) list.innerHTML = "<div style='text-align:center;color:#999;margin-top:20px;'>èƒŒåŒ…æ˜¯ç©ºçš„...å¿«å»æŠ•éæ„›å¿ƒï¼</div>";
            
            records.forEach(r => {
                const item = document.createElement('div');
                item.className = 'ticket-card';
                item.innerHTML = `<div style="font-weight:bold;font-size:12px;">To: ${r.unit}</div><div style="font-size:11px;color:#666;">"${r.msg}"</div><div style="font-size:10px;color:var(--primary);margin-top:5px;">ğŸ ${r.prop}</div>`;
                list.appendChild(item);
            });
            document.getElementById('inventory-modal').style.display = 'flex';
        }

        function openSWLayer() { document.getElementById('sw-modal').style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    </script>
</body>
</html>
