<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é¦¬å¹´ Â· å¥½é‹å•Ÿå‹•å°ï¼ˆç°¡ç´„ä¸­å¼ Demoï¼‰</title>

  <!-- Optional fonts (online). Offline will fallback gracefully. -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500&family=Noto+Serif+TC:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Minimal Chinese New Year palette (matte) */
      --bg:#121212;
      --bg2:#1A1A1A;
      --red:#8C1D18;      /* èƒ­è„‚ç´…ï¼ˆéœ§é¢ï¼‰ */
      --red2:#6E1B17;     /* æ£—ç´…ï¼ˆåæš—ï¼‰ */
      --gold:#C9A24D;     /* éœ§é‡‘ */
      --ivory:#F5EFE6;    /* ç±³ç™½ */
      --muted:rgba(245,239,230,.75);
      --line:rgba(245,239,230,.18);
      --shadow:0 18px 50px rgba(0,0,0,.45);
      --radius:18px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      /* Red â€œrespondsâ€ but never becomes full-red: just soft halos */
      background:
        radial-gradient(900px 520px at 50% 0%, rgba(140,29,24,.22), transparent 62%),
        radial-gradient(800px 520px at 50% 100%, rgba(201,162,77,.10), transparent 60%),
        radial-gradient(1200px 800px at 20% 55%, rgba(140,29,24,.10), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--ivory);
      font-family:"Noto Sans TC", system-ui, -apple-system, "PingFang TC", "Microsoft JhengHei", sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }

    .frame{
      width:min(430px, 100%);
      background:rgba(18,18,18,.72);
      border:1px solid rgba(245,239,230,.10);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
    }

    /* subtle â€œpaper grainâ€ */
    .frame::before{
      content:"";
      position:absolute;
      inset:0;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='120' height='120' filter='url(%23n)' opacity='.10'/%3E%3C/svg%3E");
      opacity:.26;
      pointer-events:none;
      mix-blend-mode:overlay;
    }

    .header{
      padding:18px 18px 10px;
      position:relative;
      z-index:1;
    }
    .kicker{
      letter-spacing:.24em;
      text-transform:uppercase;
      color:rgba(201,162,77,.85);
      font-size:12px;
      margin-bottom:6px;
    }
    .title{
      font-family:"Noto Serif TC", "Noto Sans TC", serif;
      font-weight:700;
      font-size:26px;
      line-height:1.2;
      margin:0 0 6px;
    }
    .subtitle{
      margin:0;
      color:var(--muted);
      font-size:14px;
      line-height:1.6;
    }

    .divider{
      height:1px;
      background:linear-gradient(90deg, transparent, var(--line), transparent);
      margin:14px 0 0;
    }

    .content{
      padding:16px 18px 18px;
      position:relative;
      z-index:1;
    }

    .panel{
      position:relative; /* for mute button */
      border:1px solid rgba(245,239,230,.12);
      border-radius:16px;
      padding:14px;
      background:rgba(26,26,26,.55);
    }

    label{
      display:block;
      font-size:12px;
      color:rgba(245,239,230,.70);
      margin:2px 0 8px;
      letter-spacing:.06em;
    }
    .input{
      width:100%;
      border:1px solid rgba(245,239,230,.16);
      background:rgba(245,239,230,.06);
      color:var(--ivory);
      padding:12px 12px;
      border-radius:14px;
      outline:none;
      font-size:16px;
    }
    .input:focus{
      border-color:rgba(201,162,77,.55);
      box-shadow:0 0 0 4px rgba(201,162,77,.10);
    }
    .row{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-top:12px;
    }

    .stepper{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border:1px solid rgba(245,239,230,.16);
      background:rgba(245,239,230,.06);
      border-radius:14px;
      width:100%;
      justify-content:space-between;
    }
    .stepper .btn{
      width:40px;height:40px;
      border-radius:12px;
      border:1px solid rgba(245,239,230,.16);
      background:rgba(18,18,18,.35);
      color:var(--ivory);
      font-size:18px;
      cursor:pointer;
    }
    .stepper .btn:active{ transform:translateY(1px); }
    .stepper .value{
      font-family:"Noto Serif TC", serif;
      font-weight:700;
      font-size:18px;
      letter-spacing:.08em;
      color:rgba(245,239,230,.92);
    }

    .cta{
      margin-top:14px;
      width:100%;
      height:52px;
      border:none;
      border-radius:16px;
      color:var(--ivory);
      cursor:pointer;
      font-size:16px;
      letter-spacing:.08em;
      background:
        linear-gradient(180deg, rgba(201,162,77,.18), rgba(201,162,77,.04)),
        linear-gradient(180deg, var(--red), var(--red2));
      box-shadow:0 10px 28px rgba(140,29,24,.30);
      position:relative;
      overflow:hidden;
    }
    .cta::after{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 30% 30%, rgba(245,239,230,.18), transparent 55%);
      transform:translateX(-18%);
      transition:transform .6s ease;
    }
    .cta:hover::after{ transform:translateX(6%); }
    .cta:disabled{
      cursor:not-allowed;
      opacity:.55;
      box-shadow:none;
    }

    .hint{
      margin-top:10px;
      font-size:12px;
      color:rgba(245,239,230,.58);
      text-align:center;
    }

    /* Screens */
    .screen{ display:none; }
    .screen.active{ display:block; }

    /* ===== Spin screen ===== */
    .spinWrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      padding:12px 8px 10px;
    }

    .scanLine{
      width:100%;
      height:1px;
      background:linear-gradient(90deg, transparent, rgba(201,162,77,.55), transparent);
      opacity:.65;
      position:relative;
      overflow:hidden;
      border-radius:999px;
      margin-top:2px;
    }
    .scanLine::after{
      content:"";
      position:absolute;
      top:-1px; left:-30%;
      width:30%; height:3px;
      background:linear-gradient(90deg, transparent, rgba(245,239,230,.35), transparent);
      animation:scan 1.4s ease-in-out infinite;
      opacity:.9;
    }
    .spinTitle{
      font-family:"Noto Serif TC", serif;
      font-weight:700;
      font-size:18px;
      margin:6px 0 0;
    }
    .spinText{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
      text-align:center;
      max-width:32ch;
    }

    /* ===== Envelope (Red Packet) Visual ===== */
    .envelopeStage{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:10px 0 2px;
      position:relative;
    }

    .envelope{
      width:170px;
      height:200px;
      position:relative;
      border-radius:18px;
      background:
        radial-gradient(120px 120px at 35% 30%, rgba(245,239,230,.10), transparent 60%),
        linear-gradient(180deg, rgba(201,162,77,.10), rgba(201,162,77,.02)),
        linear-gradient(180deg, var(--red), var(--red2));
      border:1px solid rgba(201,162,77,.35);
      box-shadow:0 18px 55px rgba(0,0,0,.55);
      overflow:hidden;
    }

    .env-body{
      position:absolute;
      inset:0;
      background:
        linear-gradient(90deg, rgba(245,239,230,.06), transparent 35%, rgba(245,239,230,.04)),
        radial-gradient(220px 120px at 50% 20%, rgba(201,162,77,.10), transparent 60%);
      opacity:.9;
    }

    .env-flap{
      position:absolute;
      left:0; right:0;
      top:0;
      height:62%;
      background:
        linear-gradient(180deg, rgba(245,239,230,.08), rgba(245,239,230,0)),
        linear-gradient(180deg, rgba(201,162,77,.14), rgba(201,162,77,.03));
      clip-path:polygon(0 0, 100% 0, 50% 72%);
      opacity:.9;
    }

    .env-seal{
      position:absolute;
      left:50%;
      top:56%;
      transform:translate(-50%,-50%);
      width:56px;height:56px;
      border-radius:16px;
      border:1px solid rgba(201,162,77,.55);
      background:
        radial-gradient(circle at 50% 35%, rgba(245,239,230,.16), transparent 60%),
        linear-gradient(180deg, rgba(201,162,77,.20), rgba(201,162,77,.06));
      display:grid;
      place-items:center;
      font-family:"Noto Serif TC", serif;
      font-weight:700;
      letter-spacing:.2em;
      padding-left:.2em;
      color:rgba(245,239,230,.92);
      box-shadow:0 10px 28px rgba(0,0,0,.35);
      opacity:.95;
    }

    .env-card{
      position:absolute;
      left:12%;
      width:76%;
      height:62%;
      bottom:-36%;
      border-radius:14px;
      background:
        linear-gradient(180deg, rgba(245,239,230,.92), rgba(245,239,230,.82));
      border:1px solid rgba(0,0,0,.10);
      box-shadow:0 16px 40px rgba(0,0,0,.35);
      animation:cardFloat 2.8s ease-in-out infinite;
    }
    .env-card-line{
      height:10px;
      margin:16px 16px 0;
      border-radius:999px;
      background:rgba(18,18,18,.10);
    }
    .env-card-line.short{ width:62%; }

    .env-spark{
      position:absolute;
      width:220px;
      height:220px;
      border-radius:999px;
      background:radial-gradient(circle, rgba(201,162,77,.18), transparent 62%);
      filter:blur(0.2px);
      opacity:.7;
      animation:sparkPulse 2.6s ease-in-out infinite;
    }

    /* ===== Quote ticker ===== */
    .quoteTicker{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(201,162,77,.25);
      background:rgba(18,18,18,.22);
      color:rgba(245,239,230,.88);
      font-size:13px;
      line-height:1.7;
      max-width:34ch;
      text-align:center;
    }
    .quoteTicker .qMark{
      color:rgba(201,162,77,.9);
      font-weight:600;
    }

    /* ===== Stamp row (å°ç´…åŒ…æ„Ÿ) ===== */
    .stampRow{
      margin-top:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      color:rgba(245,239,230,.70);
      font-size:12px;
      letter-spacing:.18em;
    }
    .stampDot{
      color:rgba(201,162,77,.85);
      transform:translateY(-1px);
    }
    .stampText{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(201,162,77,.28);
      background:rgba(18,18,18,.18);
      position:relative;
    }
    .stampText::after{
      content:"å°";
      position:absolute;
      right:-10px;
      top:-12px;
      width:28px;height:28px;
      border-radius:10px;
      border:1px solid rgba(201,162,77,.45);
      background:
        radial-gradient(circle at 50% 35%, rgba(245,239,230,.14), transparent 60%),
        linear-gradient(180deg, rgba(201,162,77,.20), rgba(201,162,77,.06));
      display:grid;
      place-items:center;
      font-family:"Noto Serif TC", serif;
      font-weight:700;
      color:rgba(245,239,230,.92);
      box-shadow:0 10px 26px rgba(0,0,0,.35);
      opacity:.95;
      transform:rotate(-8deg) scale(.96);
      animation:stampTap 2.2s ease-in-out infinite;
    }

    /* Mute button */
    .muteBtn{
      position:absolute;
      right:16px;
      top:14px;
      height:34px;
      padding:0 10px;
      border-radius:12px;
      border:1px solid rgba(245,239,230,.16);
      background:rgba(18,18,18,.25);
      color:rgba(245,239,230,.78);
      font-size:12px;
      letter-spacing:.08em;
      cursor:pointer;
    }
    .muteBtn:active{ transform:translateY(1px); }

    /* ===== Result screen ===== */
    .resultCard{
      border:1px solid rgba(245,239,230,.12);
      border-radius:18px;
      background:
        radial-gradient(900px 450px at 50% 0%, rgba(140,29,24,.16), transparent 62%),
        rgba(26,26,26,.55);
      padding:16px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(201,162,77,.35);
      color:rgba(201,162,77,.95);
      font-size:12px;
      letter-spacing:.08em;
    }
    .bigName{
      margin:12px 0 6px;
      font-family:"Noto Serif TC", serif;
      font-weight:700;
      font-size:26px;
      letter-spacing:.04em;
      line-height:1.25;
    }
    .gift{
      margin:10px 0 0;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(245,239,230,.12);
      background:rgba(245,239,230,.04);
    }
    .gift .label{
      font-size:12px;
      color:rgba(245,239,230,.70);
      letter-spacing:.08em;
      margin-bottom:6px;
    }
    .gift .value{
      font-size:16px;
      font-weight:600;
      color:rgba(245,239,230,.92);
      line-height:1.4;
    }
    .quote{
      margin-top:12px;
      padding:12px 12px;
      border-left:3px solid rgba(201,162,77,.55);
      background:rgba(18,18,18,.22);
      border-radius:14px;
      color:rgba(245,239,230,.85);
      line-height:1.8;
      font-size:14px;
    }
    .quote small{
      display:block;
      margin-top:6px;
      color:rgba(245,239,230,.55);
      font-size:12px;
    }

    .actions{
      display:flex;
      gap:10px;
      margin-top:14px;
    }
    .ghost{
      flex:1;
      height:46px;
      border-radius:16px;
      border:1px solid rgba(245,239,230,.16);
      background:rgba(245,239,230,.04);
      color:rgba(245,239,230,.86);
      cursor:pointer;
      letter-spacing:.08em;
    }
    .primarySmall{
      flex:1;
      height:46px;
      border-radius:16px;
      border:none;
      cursor:pointer;
      color:var(--ivory);
      background:linear-gradient(180deg, var(--red), var(--red2));
      box-shadow:0 10px 24px rgba(140,29,24,.28);
      letter-spacing:.08em;
    }

    .footerNote{
      margin-top:10px;
      text-align:center;
      font-size:12px;
      color:rgba(245,239,230,.55);
      line-height:1.6;
    }

    @keyframes scan{
      0%{ left:-30%; }
      50%{ left:50%; }
      100%{ left:110%; }
    }
    @keyframes cardFloat{
      0%,100%{ transform:translateY(0); }
      50%{ transform:translateY(-10px); }
    }
    @keyframes sparkPulse{
      0%,100%{ transform:scale(1); opacity:.65; }
      50%{ transform:scale(1.05); opacity:.9; }
    }
    @keyframes stampTap{
      0%,70%,100%{ transform:rotate(-8deg) scale(.96) translateY(0); opacity:.95; }
      80%{ transform:rotate(-8deg) scale(.98) translateY(1px); opacity:1; }
      90%{ transform:rotate(-8deg) scale(.96) translateY(0); opacity:.95; }
    }

    @media (prefers-reduced-motion: reduce){
      .scanLine::after{ animation:none; }
      .env-card{ animation:none; }
      .env-spark{ animation:none; }
      .stampText::after{ animation:none; }
      .cta::after{ transition:none; }
    }
  </style>
</head>

<body>
  <main class="frame" role="main">
    <header class="header">
      <div class="kicker">æ–°å¹´ Â· ç¥ç¦ç”Ÿæˆ</div>
      <h1 class="title">ä¸™åˆå¹´ Â· å¥½é‹å•Ÿå‹•å°</h1>
      <p class="subtitle">è«‹ç•™ä¸‹åå­—ï¼Œè®“æ–°å¹´çš„ç¥ç¦æ‰¾åˆ°ä½ ã€‚</p>
      <div class="divider"></div>
    </header>

    <section class="content">
      <!-- Screen 1: Input -->
      <div id="screenInput" class="screen active">
        <div class="panel">
          <label for="nameInput">ä½ çš„åå­—ï¼ˆåƒé¡Œå­—ä¸€æ¨£ï¼‰</label>
          <input id="nameInput" class="input" inputmode="text" maxlength="12"
                 placeholder="ä¾‹å¦‚ï¼šå°å®‰ / å®¶è±ª / é˜¿å¬¤" />

          <div class="row" style="margin-top:14px;">
            <div style="width:100%;">
              <label>å¥½é‹ä»½é‡ï¼ˆä»Šå¹´æƒ³æ¥ä½çš„å¸Œæœ›ï¼‰</label>
              <div class="stepper" aria-label="å¥½é‹ä»½é‡">
                <button id="minusBtn" class="btn" type="button" aria-label="æ¸›å°‘">âˆ’</button>
                <div id="amountValue" class="value" aria-live="polite">1</div>
                <button id="plusBtn" class="btn" type="button" aria-label="å¢åŠ ">ï¼‹</button>
              </div>
            </div>
          </div>

          <button id="startBtn" class="cta" type="button">å•Ÿå‹•å¥½é‹</button>
          <div class="hint">ç„¡éœ€ææ¬¾ï½œç´„ 10 ç§’å®Œæˆ</div>
        </div>
      </div>

      <!-- Screen 2: Spin -->
      <div id="screenSpin" class="screen" aria-live="polite">
        <div class="panel spinWrap">
          <button class="muteBtn" id="muteBtn" type="button" aria-label="åˆ‡æ›éŸ³æ•ˆ">éŸ³æ•ˆï¼šé–‹</button>

          <div class="envelopeStage" aria-hidden="true">
            <div class="envelope">
              <div class="env-body"></div>
              <div class="env-flap"></div>
              <div class="env-seal">ç¦</div>
              <div class="env-card">
                <div class="env-card-line"></div>
                <div class="env-card-line short"></div>
              </div>
            </div>
            <div class="env-spark"></div>
          </div>

          <div class="scanLine" aria-hidden="true"></div>

          <h2 class="spinTitle">ç¥ç¦ç”Ÿæˆä¸­</h2>
          <p class="spinText" id="spinText">é¦¬è¹„è²èµ·ï¼Œé¡˜ä½ æ­¥æ­¥å‘å‰ã€‚</p>

          <div class="quoteTicker" id="quoteTicker" role="status" aria-live="polite">
            <span class="qMark">ã€Œ</span><span id="tickerText">æŠŠå¸Œæœ›ç•™åœ¨å¿ƒè£¡ï¼Œå¥½é‹è‡ªç„¶æœƒä¾†ã€‚</span><span class="qMark">ã€</span>
          </div>

          <div class="stampRow" aria-hidden="true">
            <span class="stampText" id="stampText">å°å­˜ç¥ç¦ä¸­</span>
            <span class="stampDot">â€¢</span>
            <span class="stampText2" id="stampText2">è«‹ç¨å€™</span>
          </div>
        </div>

        <div class="footerNote">è«‹ç¨å€™ï¼Œæ­£åœ¨å°å¥½ä½ çš„æ–°å¹´ç´…åŒ…ç¥ç¦ã€‚</div>
      </div>

      <!-- Screen 3: Result -->
      <div id="screenResult" class="screen">
        <div class="resultCard">
          <div class="badge">ç¥ç¦å·²ç”Ÿæˆ</div>
          <div id="nameLine" class="bigName">â€”</div>

          <div class="gift">
            <div class="label">ğŸ å¥½é‹å…¥æ‰‹</div>
            <div id="giftLine" class="value">â€”</div>
          </div>

          <div class="quote" id="quoteBox">
            ã€Œâ€”ã€
            <small id="quoteAuthor">â€”</small>
          </div>

          <div class="actions">
            <button id="copyBtn" class="ghost" type="button">è¤‡è£½çµæœæ–‡å­—</button>
            <button id="resetBtn" class="primarySmall" type="button">ä¸‹ä¸€ä½å•Ÿå‹•</button>
          </div>

          <div class="footerNote">ç¥ç¦å·²å®Œæˆç”Ÿæˆï¼Œè«‹é ˜å–ä½ çš„ç´…åŒ…ç¥ç¦ã€‚</div>
        </div>
      </div>
    </section>
  </main>

  <script>
    // ===== Config =====
    const REWARDS = [
      { amount: 500, label: "500 å…ƒã€Œå¸Œæœ›ç„¡çª®ã€åˆ®åˆ®æ¨‚" },
      { amount: 200, label: "200 å…ƒã€Œå¸Œæœ›ç„¡çª®ã€åˆ®åˆ®æ¨‚" }
    ];

    // NOTE:
    // If you want "real celebrities + correct source", prepare a verified list.
    // This demo uses safe, non-controversial â€œæ–°å¹´ç®´è¨€â€ to avoid misattribution.
    const QUOTES = [
      { text: "ä¸€æ­¥ä¸€æ­¥èµ°ï¼Œå¥½é‹å°±åœ¨è·¯ä¸Šã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "å¿ƒå®šäº†ï¼Œè·¯å°±äº®äº†ã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "æ–°çš„ä¸€å¹´ï¼Œé¡˜åŠªåŠ›éƒ½æœ‰å›æ‡‰ã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "è¡Œå‹•ï¼Œå°±æ˜¯æœ€å¥½çš„ç¥ç¦ã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "æ…¢æ…¢ä¾†ï¼Œä¹Ÿæ˜¯ä¸€ç¨®å‰é€²ã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "é¡˜ä½ æ‰€èµ°çš„æ¯ä¸€æ­¥ï¼Œéƒ½é è¿‘å¿ƒä¹‹æ‰€å‘ã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "æŠŠå¸Œæœ›ç•™åœ¨å¿ƒè£¡ï¼Œå¥½é‹è‡ªç„¶æœƒä¾†ã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "æ–°å¹´ä¸æ˜¯é‡ä¾†ï¼Œè€Œæ˜¯æ›´é è¿‘ã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "é¡˜å–„æ„æˆç‚ºä½ æœ€é•·ä¹…çš„é‹æ°£ã€‚", author: "æ–°å¹´ç®´è¨€" },
      { text: "é¡˜ä»Šå¤©çš„æœŸå¾…ï¼Œæˆç‚ºæ˜å¤©çš„æ”¶ç©«ã€‚", author: "æ–°å¹´ç®´è¨€" }
    ];

    // ===== State =====
    let amount = 1;
    let currentName = "";
    let currentReward = null;
    let currentQuote = null;

    let tickerTimer = null;
    let isMuted = false;

    // ===== DOM =====
    const screenInput  = document.getElementById("screenInput");
    const screenSpin   = document.getElementById("screenSpin");
    const screenResult = document.getElementById("screenResult");

    const nameInput = document.getElementById("nameInput");
    const amountValue = document.getElementById("amountValue");
    const minusBtn = document.getElementById("minusBtn");
    const plusBtn = document.getElementById("plusBtn");
    const startBtn = document.getElementById("startBtn");

    const nameLine = document.getElementById("nameLine");
    const giftLine = document.getElementById("giftLine");
    const quoteBox = document.getElementById("quoteBox");
    const quoteAuthor = document.getElementById("quoteAuthor");

    const resetBtn = document.getElementById("resetBtn");
    const copyBtn = document.getElementById("copyBtn");

    const spinText = document.getElementById("spinText");
    const tickerText = document.getElementById("tickerText");
    const muteBtn = document.getElementById("muteBtn");

    // ===== Helpers =====
    function show(screen){
      [screenInput, screenSpin, screenResult].forEach(s => s.classList.remove("active"));
      screen.classList.add("active");
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function pick(arr){
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function normalizeName(raw){
      const n = (raw || "").trim();
      return n.replace(/\s+/g, " ");
    }

    function setAmount(next){
      amount = clamp(next, 1, 9);
      amountValue.textContent = String(amount);
    }

    function validate(){
      const n = normalizeName(nameInput.value);
      startBtn.disabled = n.length === 0;
    }

    function renderResult(){
      const displayName = currentName.length ? currentName : "ä½ ";
      nameLine.textContent = `${displayName} çš„æ–°å¹´å¥½é‹`;
      giftLine.textContent = `å¥½é‹å…¥æ‰‹ï¼š${currentReward.label}`;

      // Update quote
      quoteBox.firstChild && (quoteBox.firstChild.textContent = `ã€Œ${currentQuote.text}ã€`);
      quoteAuthor.textContent = `â€” ${currentQuote.author}`;
    }

    function buildShareText(){
      const displayName = currentName.length ? currentName : "æˆ‘";
      return [
        "ã€é¦¬å¹´ Â· å¥½é‹å•Ÿå‹•å°ã€‘",
        `${displayName} çš„æ–°å¹´å¥½é‹å·²ç”Ÿæˆ`,
        `ğŸ ${currentReward.label}`,
        `ã€Œ${currentQuote.text}ã€â€” ${currentQuote.author}`
      ].join("\n");
    }

    function startTicker(){
      stopTicker();
      if (!tickerText) return;
      tickerTimer = window.setInterval(() => {
        const q = pick(QUOTES);
        tickerText.textContent = q.text;
      }, 1800);
    }

    function stopTicker(){
      if (tickerTimer){
        window.clearInterval(tickerTimer);
        tickerTimer = null;
      }
    }

    function playDing(){
      if (isMuted) return;
      try{
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        const ctx = new AudioCtx();

        const o = ctx.createOscillator();
        const g = ctx.createGain();

        o.type = "sine";
        o.frequency.setValueAtTime(880, ctx.currentTime);
        o.frequency.exponentialRampToValueAtTime(1320, ctx.currentTime + 0.08);

        g.gain.setValueAtTime(0.0001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.12, ctx.currentTime + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.18);

        o.connect(g);
        g.connect(ctx.destination);

        o.start();
        o.stop(ctx.currentTime + 0.2);
        o.onended = () => ctx.close();
      }catch(e){
        // ignore (autoplay policies / unavailable)
      }
    }

    // ===== Events =====
    minusBtn.addEventListener("click", () => setAmount(amount - 1));
    plusBtn.addEventListener("click", () => setAmount(amount + 1));

    nameInput.addEventListener("input", validate);
    nameInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !startBtn.disabled) startBtn.click();
    });

    if (muteBtn){
      muteBtn.addEventListener("click", () => {
        isMuted = !isMuted;
        muteBtn.textContent = isMuted ? "éŸ³æ•ˆï¼šé—œ" : "éŸ³æ•ˆï¼šé–‹";
      });
    }

    startBtn.addEventListener("click", () => {
      currentName = normalizeName(nameInput.value);
      if (!currentName) return;

      currentReward = pick(REWARDS);
      currentQuote = pick(QUOTES);

      spinText.textContent = `${currentName}ï¼Œé¦¬è¹„è²èµ·ï¼Œé¡˜ä½ æ­¥æ­¥å‘å‰ã€‚`;

      show(screenSpin);
      startTicker();

      // Simulate 9â€“11 seconds â€œç”Ÿæˆâ€
      const ms = 9000 + Math.floor(Math.random() * 2000);

      window.setTimeout(() => {
        stopTicker();
        playDing();
        renderResult();
        show(screenResult);
      }, ms);
    });

    resetBtn.addEventListener("click", () => {
      stopTicker();
      currentName = "";
      currentReward = null;
      currentQuote = null;
      nameInput.value = "";
      setAmount(1);
      validate();
      show(screenInput);
      nameInput.focus();
    });

    copyBtn.addEventListener("click", async () => {
      const text = buildShareText();
      try{
        await navigator.clipboard.writeText(text);
        copyBtn.textContent = "å·²è¤‡è£½ âœ”";
        window.setTimeout(() => (copyBtn.textContent = "è¤‡è£½çµæœæ–‡å­—"), 1200);
      }catch(err){
        window.prompt("è¤‡è£½ä»¥ä¸‹æ–‡å­—ï¼š", text);
      }
    });

    // Init
    setAmount(1);
    validate();
    nameInput.focus();
  </script>
</body>
</html>
