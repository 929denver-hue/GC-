<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>72æ³•å‰‡å¯¦æ¸¬ - å¯¦è³ªè³¼è²·åŠ›èˆ‡é¢¨éšªåˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- å…¨å±€è¨­å®š --- */
        body { font-family: 'PingFang TC', 'Microsoft JhengHei', 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; color: #333; line-height: 1.5; }
        .container { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); max-width: 1000px; margin: auto; }
        h1 { text-align: center; color: #202124; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #5f6368; margin-bottom: 30px; font-size: 0.95rem; }

        /* --- è¼¸å…¥å€ä½ˆå±€ --- */
        .input-card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { padding: 20px; border-radius: 12px; border: 1px solid #e0e0e0; background: #fff; transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .card.plan-a { border-top: 6px solid #34a853; }
        .card.plan-b { border-top: 6px solid #4285f4; }
        .card.plan-c { border-top: 6px solid #fabc05; }
        .card.inflation { border-top: 6px solid #ea4335; background: #fff8f8; }

        h4 { margin: 0 0 10px 0; font-size: 1.1rem; color: #202124; }
        label { display: block; font-size: 0.85rem; font-weight: bold; color: #5f6368; margin-bottom: 5px; }
        input { width: 100%; padding: 10px; border: 1px solid #dadce0; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        input:focus { outline: none; border-color: #1a73e8; }
        
        button { width: 100%; padding: 16px; background: #202124; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: bold; transition: background 0.3s; }
        button:hover { background: #d93025; }

        .chart-container { height: 500px; margin-top: 40px; position: relative; }

        /* --- è‡ªå‹•æ‘˜è¦å ±å‘Š --- */
        .summary-box { margin-top: 40px; padding: 25px; background: #fdfdfd; border: 1px solid #eee; border-radius: 12px; border-left: 6px solid #202124; }
        .summary-box h3 { margin: 0 0 15px 0; display: flex; align-items: center; gap: 8px; }
        .summary-item { margin-bottom: 12px; font-size: 1.05rem; padding-bottom: 8px; border-bottom: 1px dashed #eee; }
        .summary-item:last-child { border-bottom: none; }
        
        /* é¡è‰²è­¦ç¤ºé‚è¼¯ (å¢ç´…æ¸›ç¶ ) */
        .alert-increase { color: #d93025; font-weight: 900; background: #fce8e6; padding: 2px 6px; border-radius: 4px; }
        .alert-decrease { color: #188038; font-weight: 900; background: #e6f4ea; padding: 2px 6px; border-radius: 4px; }

        /* --- å°ˆæ¥­å‚™è¨»å€ (é»ƒè‰²è­¦å‘Šæ¡†é¢¨æ ¼) --- */
        .notes-section { 
            margin-top: 40px; 
            padding: 30px; 
            background-color: #fff8e1; /* æ·ºé»ƒèƒŒæ™¯ */
            border-left: 6px solid #ffc107; /* æ·±é»ƒé‚Šæ¡† */
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .notes-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .notes-header h2 { margin: 0; color: #856404; font-size: 1.3rem; }
        
        .ref-link { padding: 8px 20px; background-color: white; color: #856404; border: 2px solid #856404; border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 0.9rem; transition: 0.3s; }
        .ref-link:hover { background-color: #856404; color: white; }

        .formula-box { background: #202124; color: #fff; text-align: center; padding: 15px; font-size: 1.5rem; font-weight: bold; border-radius: 8px; margin: 20px 0; }
        
        .notes-list { list-style: none; padding: 0; margin: 0; }
        .notes-list li { margin-bottom: 12px; color: #533f03; line-height: 1.6; font-size: 1rem; }
        .notes-list strong { color: #000; text-decoration: underline decoration-color #ffc107; text-decoration-thickness: 3px; }

    </style>
</head>
<body>

<div class="container">
    <h1>72æ³•å‰‡å¯¦æ¸¬è¨ˆç®—å™¨</h1>
    <p class="subtitle">å°‡é€šè†¨ç´å…¥è€ƒé‡ï¼Œç²¾æº–è¨ˆç®—è³‡ç”¢çš„ã€Œå¯¦è³ªå¢å€¼ã€æˆ–ã€Œè³¼è²·åŠ›è…°æ–¬ã€é¢¨éšª</p>
    
    <div class="input-card-grid">
        <div class="card plan-a"><h4>æ–¹æ¡ˆA(å®šå­˜)</h4><label>é ä¼°å¹´åˆ©ç‡ (%)</label><input type="number" id="rateA" value="1.5"></div>
        <div class="card plan-b"><h4>æ–¹æ¡ˆB(ETF)</h4><label>é ä¼°å¹´åˆ©ç‡ (%)</label><input type="number" id="rateB" value="6"></div>
        <div class="card plan-c"><h4>æ–¹æ¡ˆC(ç©æ¥µ)</h4><label>é ä¼°å¹´åˆ©ç‡ (%)</label><input type="number" id="rateC" value="10"></div>
        <div class="card inflation"><h4>âš ï¸ å…¨å±€é€šè†¨</h4><label>é ä¼°å¹´é€šè†¨ (%)</label><input type="number" id="rateInf" value="3" style="color:#ea4335; font-weight:bold;"><label>æ¨¡æ“¬å¹´æ•¸</label><input type="number" id="years" value="40"></div>
    </div>

    <div style="margin-bottom: 20px;">
        <label>åˆå§‹æœ¬é‡‘ (è¬å…ƒ)ï¼š</label>
        <input type="number" id="principal" value="100" style="width: 200px; font-weight: bold;">
    </div>

    <button onclick="updateComparisonChart()">é–‹å§‹è¨ˆç®—</button>

    <div id="summaryReport" class="summary-box" style="display:none;">
        <h3>ğŸ“Šå¯¦è³ªè³‡ç”¢æ‘˜è¦</h3>
        <div id="summaryContent"></div>
    </div>

    <div class="chart-container"><canvas id="compChart"></canvas></div>

    <div class="notes-section">
        <div class="notes-header">
            <h2>ğŸ’¡72æ³•å‰‡èªªæ˜èˆ‡å‚™è¨»</h2>
            <a href="https://drive.google.com/file/d/1Lp3iPBmWRkoDQGOWY4qatXjCzYY7YlVe/view?usp=sharing" target="_blank" class="ref-link">ğŸ”— æŸ¥çœ‹è©³ç´°èªªæ˜æ–‡ä»¶</a>
        </div>
        
        <div class="formula-box">å¯¦è³ªç¿»å€(æˆ–æ¸›åŠ)å¹´æ•¸ â‰ˆ 72 Ã· |æŠ•è³‡ç‡ - é€šè†¨ç‡|</div>

        <ul class="notes-list">
            <li><strong>1. é‚è¼¯ä¿®æ­£ï¼š</strong> æœ¬å·¥å…·è¨ˆç®—çš„æ˜¯ã€Œå¯¦è³ªåˆ©ç‡ã€ã€‚è‹¥å ±é…¬ä½æ–¼é€šè†¨ï¼Œä¸å†ç¨±ç‚ºç¿»å€ï¼Œè€Œæ˜¯è¨ˆç®—<strong>ã€Œè³¼è²·åŠ›æ¸›åŠã€</strong>ï¼ˆè…°æ–¬ï¼‰æ‰€éœ€æ™‚é–“ã€‚</li>
            <li><strong>2. è¤‡åˆ©æ˜¯å‰æï¼š</strong> å¿…é ˆæ˜¯åˆ©æ¯ä¸æé ˜ã€æŒçºŒã€Œåˆ©æ»¾åˆ©ã€çš„æƒ…æ³ä¸‹ï¼Œæ­¤æ³•å‰‡æ‰æº–ç¢ºã€‚</li>
            <li><strong>3. é©ç”¨ç¯„åœï¼š</strong> ç¶“éæ•¸å­¸æ¸¬ç®—ï¼Œå¯¦è³ªåˆ©ç‡åœ¨ <strong>6% - 10%</strong> ä¹‹é–“æ™‚ï¼Œæº–ç¢ºåº¦æœ€é«˜ã€‚</li>
            <li><strong>4. åœ–è¡¨è§£è®€èˆ‡è¡Œå‹•å»ºè­°ï¼š</strong> 
                <br>â€¢ <span style="color:#FFD700; font-weight:bold;">â— é‡‘è‰²åœ“é»</span>ï¼šä»£è¡¨å¯¦è³ªè³¼è²·åŠ›<strong>ç¿»å€</strong> (è²¡å¯Œå¢é•·)ã€‚
                <br>â€¢ <span style="color:#333; font-weight:bold;">â— é»‘è‰²åœ“é»</span>ï¼šä»£è¡¨å¯¦è³ªè³¼è²·åŠ›<strong>æ¸›åŠ</strong> (è²¡å¯Œç¸®æ°´)ï¼Œæ‡‰ç›¡å¿«èª¿æ•´è³‡ç”¢é…ç½®ä»¥æŠµæŠ—é€šè†¨ã€‚
            </li>
        </ul>
    </div>
</div>

<script>
    let compChart = null;

    function updateComparisonChart() {
        const p = parseFloat(document.getElementById('principal').value);
        const y = parseInt(document.getElementById('years').value);
        const infRateInput = parseFloat(document.getElementById('rateInf').value);
        const infRate = infRateInput / 100;
        
        const rates = [
            { id: 'rateA', name: 'æ–¹æ¡ˆ A', color: '#34a853' },
            { id: 'rateB', name: 'æ–¹æ¡ˆ B', color: '#4285f4' },
            { id: 'rateC', name: 'æ–¹æ¡ˆ C', color: '#fabc05' }
        ];

        const labels = Array.from({length: y + 1}, (_, i) => `ç¬¬ ${i} å¹´`);
        const reportData = [];

        const datasets = rates.map(r => {
            const rValInput = parseFloat(document.getElementById(r.id).value);
            const rVal = rValInput / 100;
            
            // --- é‚è¼¯æ ¸å¿ƒï¼šè¨ˆç®—å¯¦è³ªåˆ©ç‡ ---
            const realRateInput = rValInput - infRateInput; // å¯¦è³ªå¹´åŒ– (å¦‚ 1.5 - 3 = -1.5)
            
            // --- 72 æ³•å‰‡æ‡‰ç”¨ (é›™å‘åˆ¤æ–·) ---
            let targetYear = null;
            let targetType = 'flat'; // 'double', 'halve', 'flat'

            if (realRateInput > 0) {
                targetYear = 72 / realRateInput; // å¯¦è³ªç¿»å€
                targetType = 'double';
            } else if (realRateInput < 0) {
                targetYear = 72 / Math.abs(realRateInput); // å¯¦è³ªæ¸›åŠ
                targetType = 'halve';
            }
            
            const data = [];
            const pointRadius = [];
            const pointColors = [];
            
            for(let i=0; i<=y; i++) {
                // å¯¦è³ªåƒ¹å€¼è¨ˆç®—å…¬å¼ï¼šP * [(1+r)/(1+i)]^n
                const realVal = p * Math.pow((1 + rVal) / (1 + infRate), i);
                data.push(realVal.toFixed(2));

                // æ¨™è¨˜é—œéµé» (ç¿»å€ æˆ– æ¸›åŠ)
                const isTargetPoint = targetYear && Math.abs(i - targetYear) < 0.5 && i > 0;

                if (isTargetPoint) {
                    pointRadius.push(8);
                    if (targetType === 'double') {
                        pointColors.push('#FFD700'); // é‡‘è‰²ï¼šç¿»å€
                    } else if (targetType === 'halve') {
                        pointColors.push('#333333'); // é»‘è‰²ï¼šè…°æ–¬
                    }
                } else {
                    pointRadius.push(0);
                    pointColors.push(r.color);
                }
            }
            
            reportData.push({ name: r.name, final: data[y], realRateInput, targetYear, targetType });

            // --- åœ–ä¾‹å‹•æ…‹èªªæ˜ ---
            let labelText = `${r.name}`;
            if (targetYear) {
                if (targetType === 'double') {
                    labelText += ` (å¯¦è³ªç¿»å€: ç´„${targetYear.toFixed(1)}å¹´)`;
                } else {
                    labelText += ` (è³¼è²·åŠ›æ¸›åŠ: ç´„${targetYear.toFixed(1)}å¹´)`;
                }
            } else {
                labelText += ` (è³¼è²·åŠ›æŒå¹³)`;
            }

            return {
                label: labelText,
                data: data,
                borderColor: r.color,
                backgroundColor: r.color, 
                pointBackgroundColor: pointColors, // ä½¿ç”¨è‡ªå®šç¾©é¡è‰²é™£åˆ—
                pointRadius: pointRadius,
                pointHoverRadius: 12,
                pointHitRadius: 20,
                borderWidth: 3,
                tension: 0.3,
                fill: false
            };
        });

        // åŸºæº–ç·š
        datasets.push({
            label: 'è³¼è²·åŠ›åŸºæº–ç·š (ç¶­æŒç¾ç‹€)',
            data: Array(y+1).fill(p),
            borderColor: '#999',
            borderDash: [6, 6],
            borderWidth: 2,
            pointRadius: 0,
            fill: false
        });

        // æ¸²æŸ“åœ–è¡¨
        const ctx = document.getElementById('compChart').getContext('2d');
        if (compChart) compChart.destroy();

        compChart = new Chart(ctx, {
            type: 'line',
            data: { labels, datasets },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    tooltip: {
                        backgroundColor: 'rgba(255, 255, 255, 0.95)',
                        titleColor: '#000',
                        titleFont: { size: 16, weight: 'bold' },
                        bodyColor: '#333',
                        bodyFont: { size: 14 },
                        borderColor: '#999',
                        borderWidth: 1,
                        padding: 15,
                        callbacks: { 
                            label: (ctx) => {
                                const val = parseFloat(ctx.raw);
                                const diff = (val - p).toFixed(2);
                                const sign = val >= p ? '+' : '';
                                return ` ${ctx.dataset.label.split('(')[0]}: ${val}è¬ (${sign}${diff})`; 
                            }
                        }
                    },
                    legend: { labels: { font: { size: 13 }, boxWidth: 12 } }
                },
                scales: {
                    y: { 
                        title: { display: true, text: 'å¯¦è³ªåƒ¹å€¼ (æ›ç®—ç‚ºä»Šæ—¥è¬å…ƒ)', font: { size:14, weight:'bold' } },
                        grid: { color: '#f0f0f0' }
                    }
                }
            }
        });

        renderSummary(reportData, p, y);
    }

    function renderSummary(data, p, y) {
        const contentDiv = document.getElementById('summaryContent');
        document.getElementById('summaryReport').style.display = 'block';

        let html = "";
        data.sort((a, b) => b.final - a.final);

        data.forEach(item => {
            const diff = (parseFloat(item.final) - p).toFixed(2);
            const isIncreasing = parseFloat(diff) >= 0;
            const colorClass = isIncreasing ? 'alert-increase' : 'alert-decrease';
            const statusText = isIncreasing ? 'å¯¦è³ªå¢å€¼' : 'å¯¦è³ªèç¸®';
            const icon = isIncreasing ? 'ğŸ“ˆ' : 'ğŸ“‰';

            html += `<div class="summary-item">
                        ${icon} <strong>${item.name}</strong>ï¼š${y}å¹´å¾Œè³¼è²·åŠ›${statusText} <span class="${colorClass}">${Math.abs(diff)} è¬</span>ã€‚
                     </div>`;
        });
        
        html += `<div style="margin-top:12px; font-size:0.9rem; color:#666;">
                    ğŸ’¡ è¨»ï¼šç´…è‰²ä»£è¡¨è³¼è²·åŠ›å¢å¼· (å„ªæ–¼é€šè†¨)ï¼Œç¶ è‰²ä»£è¡¨è³¼è²·åŠ›ä¸‹é™ (è¼¸çµ¦é€šè†¨)ã€‚
                 </div>`;

        contentDiv.innerHTML = html;
    }

    window.onload = updateComparisonChart;
</script>
</body>
</html>
